!function(a,b){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(c){return b(a,c)}):"object"==typeof module&&module.exports?module.exports=b(a,require("jquery")):a.jQueryBridget=b(a,a.jQuery)}(window,function(a,b){"use strict";function c(c,f,h){function i(a,b,d){var e,f="$()."+c+'("'+b+'")';return a.each(function(a,i){var j=h.data(i,c);if(!j)return void g(c+" not initialized. Cannot call methods, i.e. "+f);var k=j[b];if(!k||"_"==b.charAt(0))return void g(f+" is not a valid method");var l=k.apply(j,d);e=void 0===e?l:e}),void 0!==e?e:a}function j(a,b){a.each(function(a,d){var e=h.data(d,c);e?(e.option(b),e._init()):(e=new f(d,b),h.data(d,c,e))})}h=h||b||a.jQuery,h&&(f.prototype.option||(f.prototype.option=function(a){h.isPlainObject(a)&&(this.options=h.extend(!0,this.options,a))}),h.fn[c]=function(a){if("string"==typeof a){var b=e.call(arguments,1);return i(this,a,b)}return j(this,a),this},d(h))}function d(a){!a||a&&a.bridget||(a.bridget=c)}var e=Array.prototype.slice,f=a.console,g="undefined"==typeof f?function(){}:function(a){f.error(a)};return d(b||a.jQuery),c}),function(a,b){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",b):"object"==typeof module&&module.exports?module.exports=b():a.EvEmitter=b()}("undefined"!=typeof window?window:this,function(){function a(){}var b=a.prototype;return b.on=function(a,b){if(a&&b){var c=this._events=this._events||{},d=c[a]=c[a]||[];return-1==d.indexOf(b)&&d.push(b),this}},b.once=function(a,b){if(a&&b){this.on(a,b);var c=this._onceEvents=this._onceEvents||{},d=c[a]=c[a]||{};return d[b]=!0,this}},b.off=function(a,b){var c=this._events&&this._events[a];if(c&&c.length){var d=c.indexOf(b);return-1!=d&&c.splice(d,1),this}},b.emitEvent=function(a,b){var c=this._events&&this._events[a];if(c&&c.length){c=c.slice(0),b=b||[];for(var d=this._onceEvents&&this._onceEvents[a],e=0;e<c.length;e++){var f=c[e],g=d&&d[f];g&&(this.off(a,f),delete d[f]),f.apply(this,b)}return this}},b.allOff=function(){delete this._events,delete this._onceEvents},a}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",b):"object"==typeof module&&module.exports?module.exports=b():a.matchesSelector=b()}(window,function(){"use strict";var a=function(){var a=window.Element.prototype;if(a.matches)return"matches";if(a.matchesSelector)return"matchesSelector";for(var b=["webkit","moz","ms","o"],c=0;c<b.length;c++){var d=b[c],e=d+"MatchesSelector";if(a[e])return e}}();return function(b,c){return b[a](c)}}),function(a,b){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(c){return b(a,c)}):"object"==typeof module&&module.exports?module.exports=b(a,require("desandro-matches-selector")):a.fizzyUIUtils=b(a,a.matchesSelector)}(window,function(a,b){var c={};c.extend=function(a,b){for(var c in b)a[c]=b[c];return a},c.modulo=function(a,b){return(a%b+b)%b};var d=Array.prototype.slice;c.makeArray=function(a){if(Array.isArray(a))return a;if(null===a||void 0===a)return[];var b="object"==typeof a&&"number"==typeof a.length;return b?d.call(a):[a]},c.removeFrom=function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)},c.getParent=function(a,c){for(;a.parentNode&&a!=document.body;)if(a=a.parentNode,b(a,c))return a},c.getQueryElement=function(a){return"string"==typeof a?document.querySelector(a):a},c.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},c.filterFindElements=function(a,d){a=c.makeArray(a);var e=[];return a.forEach(function(a){if(a instanceof HTMLElement){if(!d)return void e.push(a);b(a,d)&&e.push(a);for(var c=a.querySelectorAll(d),f=0;f<c.length;f++)e.push(c[f])}}),e},c.debounceMethod=function(a,b,c){c=c||100;var d=a.prototype[b],e=b+"Timeout";a.prototype[b]=function(){var a=this[e];clearTimeout(a);var b=arguments,f=this;this[e]=setTimeout(function(){d.apply(f,b),delete f[e]},c)}},c.docReady=function(a){var b=document.readyState;"complete"==b||"interactive"==b?setTimeout(a):document.addEventListener("DOMContentLoaded",a)},c.toDashed=function(a){return a.replace(/(.)([A-Z])/g,function(a,b,c){return b+"-"+c}).toLowerCase()};var e=a.console;return c.htmlInit=function(b,d){c.docReady(function(){var f=c.toDashed(d),g="data-"+f,h=document.querySelectorAll("["+g+"]"),i=document.querySelectorAll(".js-"+f),j=c.makeArray(h).concat(c.makeArray(i)),k=g+"-options",l=a.jQuery;j.forEach(function(a){var c,f=a.getAttribute(g)||a.getAttribute(k);try{c=f&&JSON.parse(f)}catch(h){return void(e&&e.error("Error parsing "+g+" on "+a.className+": "+h))}var i=new b(a,c);l&&l.data(a,d,i)})})},c}),function(a,b){"function"==typeof define&&define.amd?define("infinite-scroll/js/core",["ev-emitter/ev-emitter","fizzy-ui-utils/utils"],function(c,d){return b(a,c,d)}):"object"==typeof module&&module.exports?module.exports=b(a,require("ev-emitter"),require("fizzy-ui-utils")):a.InfiniteScroll=b(a,a.EvEmitter,a.fizzyUIUtils)}(window,function(a,b,c){function d(a,b){var g=c.getQueryElement(a);if(!g)return void console.error("Bad element for InfiniteScroll: "+(g||a));if(a=g,a.infiniteScrollGUID){var h=f[a.infiniteScrollGUID];return h.option(b),h}this.element=a,this.options=c.extend({},d.defaults),this.option(b),e&&(this.$element=e(this.element)),this.create()}var e=a.jQuery,f={};d.defaults={},d.create={},d.destroy={};var g=d.prototype;c.extend(g,b.prototype);var h=0;g.create=function(){var a=this.guid=++h;this.element.infiniteScrollGUID=a,f[a]=this,this.pageIndex=1,this.loadCount=0,this.updateGetPath();var b=this.getPath&&this.getPath();if(!b)return void console.error("Disabling InfiniteScroll");this.updateGetAbsolutePath(),this.log("initialized",[this.element.className]),this.callOnInit();for(var c in d.create)d.create[c].call(this)},g.option=function(a){c.extend(this.options,a)},g.callOnInit=function(){var a=this.options.onInit;a&&a.call(this,this)},g.dispatchEvent=function(a,b,c){this.log(a,c);var d=b?[b].concat(c):c;if(this.emitEvent(a,d),e&&this.$element){a+=".infiniteScroll";var f=a;if(b){var g=e.Event(b);g.type=a,f=g}this.$element.trigger(f,c)}};var i={initialized:function(a){return"on "+a},request:function(a){return"URL: "+a},load:function(a,b){return(a.title||"")+". URL: "+b},error:function(a,b){return a+". URL: "+b},append:function(a,b,c){return c.length+" items. URL: "+b},last:function(a,b){return"URL: "+b},history:function(a,b){return"URL: "+b},pageIndex:function(a,b){return"current page determined to be: "+a+" from "+b}};g.log=function(a,b){if(this.options.debug){var c="[InfiniteScroll] "+a,d=i[a];d&&(c+=". "+d.apply(this,b)),console.log(c)}},g.updateMeasurements=function(){this.windowHeight=a.innerHeight;var b=this.element.getBoundingClientRect();this.top=b.top+a.pageYOffset},g.updateScroller=function(){var b=this.options.elementScroll;if(!b)return void(this.scroller=a);if(this.scroller=b===!0?this.element:c.getQueryElement(b),!this.scroller)throw"Unable to find elementScroll: "+b},g.updateGetPath=function(){var a=this.options.path;if(!a)return void console.error("InfiniteScroll path option required. Set as: "+a);var b=typeof a;if("function"==b)return void(this.getPath=a);var c="string"==b&&a.match("{{#}}");return c?void this.updateGetPathTemplate(a):void this.updateGetPathSelector(a)},g.updateGetPathTemplate=function(a){this.getPath=function(){var b=this.pageIndex+1;return a.replace("{{#}}",b)}.bind(this);var b=a.replace("{{#}}","(\\d\\d?\\d?)"),c=new RegExp(b),d=location.href.match(c);d&&(this.pageIndex=parseInt(d[1],10),this.log("pageIndex",[this.pageIndex,"template string"]))};var j=[/^(.*?\/?page\/?)(\d\d?\d?)(.*?$)/,/^(.*?\/?\?page=)(\d\d?\d?)(.*?$)/,/(.*?)(\d\d?\d?)(?!.*\d)(.*?$)/];return g.updateGetPathSelector=function(a){var b=document.querySelector(a);if(!b)return void console.error("Bad InfiniteScroll path option. Next link not found: "+a);for(var c,d,e=b.getAttribute("href"),f=0;e&&f<j.length;f++){d=j[f];var g=e.match(d);if(g){c=g.slice(1);break}}return c?(this.isPathSelector=!0,this.getPath=function(){var a=this.pageIndex+1;return c[0]+a+c[2]}.bind(this),this.pageIndex=parseInt(c[1],10)-1,void this.log("pageIndex",[this.pageIndex,"next link"])):void console.error("InfiniteScroll unable to parse next link href: "+e)},g.updateGetAbsolutePath=function(){var a=this.getPath(),b=a.match(/^http/)||a.match(/^\//);if(b)return void(this.getAbsolutePath=this.getPath);var c=location.pathname,d=c.substring(0,c.lastIndexOf("/"));this.getAbsolutePath=function(){return d+"/"+this.getPath()}},d.create.hideNav=function(){var a=c.getQueryElement(this.options.hideNav);a&&(a.style.display="none",this.nav=a)},d.destroy.hideNav=function(){this.nav&&(this.nav.style.display="")},g.destroy=function(){this.allOff();for(var a in d.destroy)d.destroy[a].call(this);delete this.element.infiniteScrollGUID,delete f[this.guid],e&&this.$element&&e.removeData(this.element,"infiniteScroll")},d.throttle=function(a,b){b=b||200;var c,d;return function(){var e=+new Date,f=arguments,g=function(){c=e,a.apply(this,f)}.bind(this);c&&c+b>e?(clearTimeout(d),d=setTimeout(g,b)):g()}},d.data=function(a){a=c.getQueryElement(a);var b=a&&a.infiniteScrollGUID;return b&&f[b]},d.setJQuery=function(a){e=a},c.htmlInit(d,"infinite-scroll"),g._init=function(){},e&&e.bridget&&e.bridget("infiniteScroll",d),d}),function(a,b){"function"==typeof define&&define.amd?define("infinite-scroll/js/page-load",["./core"],function(c){return b(a,c)}):"object"==typeof module&&module.exports?module.exports=b(a,require("./core")):b(a,a.InfiniteScroll)}(window,function(a,b){function c(a){for(var b=document.createDocumentFragment(),c=0;a&&c<a.length;c++)b.appendChild(a[c]);return b}function d(a){for(var b=a.querySelectorAll("script"),c=0;c<b.length;c++){var d=b[c],f=document.createElement("script");e(d,f),f.innerHTML=d.innerHTML,d.parentNode.replaceChild(f,d)}}function e(a,b){for(var c=a.attributes,d=0;d<c.length;d++){var e=c[d];b.setAttribute(e.name,e.value)}}function f(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType=b||"",e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.onload=function(){if(200==e.status)c(e.response);else{var a=new Error(e.statusText);d(a)}},e.onerror=function(){var b=new Error("Network error requesting "+a);d(b)},e.send()}var g=b.prototype;return b.defaults.loadOnScroll=!0,b.defaults.checkLastPage=!0,b.defaults.responseType="document",b.create.pageLoad=function(){this.canLoad=!0,this.on("scrollThreshold",this.onScrollThresholdLoad),this.on("load",this.checkLastPage),this.options.outlayer&&this.on("append",this.onAppendOutlayer)},g.onScrollThresholdLoad=function(){this.options.loadOnScroll&&this.loadNextPage()},g.loadNextPage=function(){if(!this.isLoading&&this.canLoad){var a=this.getAbsolutePath();this.isLoading=!0;var b=function(b){this.onPageLoad(b,a)}.bind(this),c=function(b){this.onPageError(b,a)}.bind(this);f(a,this.options.responseType,b,c),this.dispatchEvent("request",null,[a])}},g.onPageLoad=function(a,b){return this.options.append||(this.isLoading=!1),this.pageIndex++,this.loadCount++,this.dispatchEvent("load",null,[a,b]),this.appendNextPage(a,b),a},g.appendNextPage=function(a,b){var d=this.options.append,e="document"==this.options.responseType;if(e&&d){var f=a.querySelectorAll(d),g=c(f),h=function(){this.appendItems(f,g),this.isLoading=!1,this.dispatchEvent("append",null,[a,b,f])}.bind(this);this.options.outlayer?this.appendOutlayerItems(g,h):h()}},g.appendItems=function(a,b){a&&a.length&&(b=b||c(a),d(b),this.element.appendChild(b))},g.appendOutlayerItems=function(c,d){var e=b.imagesLoaded||a.imagesLoaded;return e?void e(c,d):(console.error("[InfiniteScroll] imagesLoaded required for outlayer option"),void(this.isLoading=!1))},g.onAppendOutlayer=function(a,b,c){this.options.outlayer.appended(c)},g.checkLastPage=function(a,b){var c=this.options.checkLastPage;if(c){var d=this.options.path;if("function"==typeof d){var e=this.getPath();if(!e)return void this.lastPageReached(a,b)}var f;if("string"==typeof c?f=c:this.isPathSelector&&(f=d),f&&a.querySelector){var g=a.querySelector(f);g||this.lastPageReached(a,b)}}},g.lastPageReached=function(a,b){this.canLoad=!1,this.dispatchEvent("last",null,[a,b])},g.onPageError=function(a,b){return this.isLoading=!1,this.canLoad=!1,this.dispatchEvent("error",null,[a,b]),a},b.create.prefill=function(){if(this.options.prefill){var a=this.options.append;if(!a)return void console.error("append option required for prefill. Set as :"+a);this.updateMeasurements(),this.updateScroller(),this.isPrefilling=!0,this.on("append",this.prefill),this.once("error",this.stopPrefill),this.once("last",this.stopPrefill),this.prefill()}},g.prefill=function(){var a=this.getPrefillDistance();this.isPrefilling=a>=0,this.isPrefilling?(this.log("prefill"),this.loadNextPage()):this.stopPrefill()},g.getPrefillDistance=function(){return this.options.elementScroll?this.scroller.clientHeight-this.scroller.scrollHeight:this.windowHeight-this.element.clientHeight},g.stopPrefill=function(){this.log("stopPrefill"),this.off("append",this.prefill)},b}),function(a,b){"function"==typeof define&&define.amd?define("infinite-scroll/js/scroll-watch",["./core","fizzy-ui-utils/utils"],function(c,d){return b(a,c,d)}):"object"==typeof module&&module.exports?module.exports=b(a,require("./core"),require("fizzy-ui-utils")):b(a,a.InfiniteScroll,a.fizzyUIUtils)}(window,function(a,b,c){var d=b.prototype;return b.defaults.scrollThreshold=400,b.create.scrollWatch=function(){this.pageScrollHandler=this.onPageScroll.bind(this),this.resizeHandler=this.onResize.bind(this);var a=this.options.scrollThreshold,b=a||0===a;b&&this.enableScrollWatch()},b.destroy.scrollWatch=function(){this.disableScrollWatch()},d.enableScrollWatch=function(){this.isScrollWatching||(this.isScrollWatching=!0,this.updateMeasurements(),this.updateScroller(),this.on("last",this.disableScrollWatch),this.bindScrollWatchEvents(!0))},d.disableScrollWatch=function(){this.isScrollWatching&&(this.bindScrollWatchEvents(!1),delete this.isScrollWatching)},d.bindScrollWatchEvents=function(b){var c=b?"addEventListener":"removeEventListener";this.scroller[c]("scroll",this.pageScrollHandler),a[c]("resize",this.resizeHandler)},d.onPageScroll=b.throttle(function(){var a=this.getBottomDistance();a<=this.options.scrollThreshold&&this.dispatchEvent("scrollThreshold")}),d.getBottomDistance=function(){return this.options.elementScroll?this.getElementBottomDistance():this.getWindowBottomDistance()},d.getWindowBottomDistance=function(){var b=this.top+this.element.clientHeight,c=a.pageYOffset+this.windowHeight;return b-c},d.getElementBottomDistance=function(){var a=this.scroller.scrollHeight,b=this.scroller.scrollTop+this.scroller.clientHeight;return a-b},d.onResize=function(){this.updateMeasurements()},c.debounceMethod(b,"onResize",150),b}),function(a,b){"function"==typeof define&&define.amd?define("infinite-scroll/js/history",["./core","fizzy-ui-utils/utils"],function(c,d){return b(a,c,d)}):"object"==typeof module&&module.exports?module.exports=b(a,require("./core"),require("fizzy-ui-utils")):b(a,a.InfiniteScroll,a.fizzyUIUtils)}(window,function(a,b,c){var d=b.prototype;b.defaults.history="replace";var e=document.createElement("a");return b.create.history=function(){if(this.options.history){e.href=this.getAbsolutePath();var a=e.origin||e.protocol+"//"+e.host,b=a==location.origin;return b?void(this.options.append?this.createHistoryAppend():this.createHistoryPageLoad()):void console.error("[InfiniteScroll] cannot set history with different origin: "+e.origin+" on "+location.origin+" . History behavior disabled.")}},d.createHistoryAppend=function(){this.updateMeasurements(),this.updateScroller(),this.scrollPages=[{top:0,path:location.href,title:document.title}],this.scrollPageIndex=0,this.scrollHistoryHandler=this.onScrollHistory.bind(this),this.unloadHandler=this.onUnload.bind(this),this.scroller.addEventListener("scroll",this.scrollHistoryHandler),this.on("append",this.onAppendHistory),this.bindHistoryAppendEvents(!0)},d.bindHistoryAppendEvents=function(b){var c=b?"addEventListener":"removeEventListener";this.scroller[c]("scroll",this.scrollHistoryHandler),a[c]("unload",this.unloadHandler)},d.createHistoryPageLoad=function(){this.on("load",this.onPageLoadHistory)},b.destroy.history=d.destroyHistory=function(){var a=this.options.history&&this.options.append;a&&this.bindHistoryAppendEvents(!1)},d.onAppendHistory=function(a,b,c){if(c&&c.length){var d=c[0],f=this.getElementScrollY(d);e.href=b,this.scrollPages.push({top:f,path:e.href,title:a.title})}},d.getElementScrollY=function(a){return this.options.elementScroll?this.getElementElementScrollY(a):this.getElementWindowScrollY(a)},d.getElementWindowScrollY=function(b){var c=b.getBoundingClientRect();return c.top+a.pageYOffset},d.getElementElementScrollY=function(a){return a.offsetTop-this.top},d.onScrollHistory=function(){for(var a,b,c=this.getScrollViewY(),d=0;d<this.scrollPages.length;d++){var e=this.scrollPages[d];if(e.top>=c)break;a=d,b=e}a!=this.scrollPageIndex&&(this.scrollPageIndex=a,this.setHistory(b.title,b.path))},c.debounceMethod(b,"onScrollHistory",150),d.getScrollViewY=function(){return this.options.elementScroll?this.scroller.scrollTop+this.scroller.clientHeight/2:a.pageYOffset+this.windowHeight/2},d.setHistory=function(a,b){var c=this.options.history,d=c&&history[c+"State"];d&&(history[c+"State"](null,a,b),this.options.historyTitle&&(document.title=a),this.dispatchEvent("history",null,[a,b]))},d.onUnload=function(){var b=this.scrollPageIndex;if(0!==b){var c=this.scrollPages[b],d=a.pageYOffset-c.top+this.top;this.destroyHistory(),scrollTo(0,d)}},d.onPageLoadHistory=function(a,b){this.setHistory(a.title,b)},b}),function(a,b){"function"==typeof define&&define.amd?define("infinite-scroll/js/button",["./core","fizzy-ui-utils/utils"],function(c,d){return b(a,c,d)}):"object"==typeof module&&module.exports?module.exports=b(a,require("./core"),require("fizzy-ui-utils")):b(a,a.InfiniteScroll,a.fizzyUIUtils)}(window,function(a,b,c){function d(a,b){this.element=a,this.infScroll=b,this.clickHandler=this.onClick.bind(this),this.element.addEventListener("click",this.clickHandler),b.on("request",this.disable.bind(this)),b.on("load",this.enable.bind(this)),b.on("error",this.hide.bind(this)),b.on("last",this.hide.bind(this))}return b.create.button=function(){var a=c.getQueryElement(this.options.button);return a?void(this.button=new d(a,this)):void 0},b.destroy.button=function(){this.button&&this.button.destroy()},d.prototype.onClick=function(a){a.preventDefault(),this.infScroll.loadNextPage()},d.prototype.enable=function(){this.element.removeAttribute("disabled")},d.prototype.disable=function(){this.element.disabled="disabled"},d.prototype.hide=function(){this.element.style.display="none"},d.prototype.destroy=function(){this.element.removeEventListener("click",this.clickHandler)},b.Button=d,b}),function(a,b){"function"==typeof define&&define.amd?define("infinite-scroll/js/status",["./core","fizzy-ui-utils/utils"],function(c,d){return b(a,c,d)}):"object"==typeof module&&module.exports?module.exports=b(a,require("./core"),require("fizzy-ui-utils")):b(a,a.InfiniteScroll,a.fizzyUIUtils)}(window,function(a,b,c){function d(a){f(a,"none")}function e(a){f(a,"block")}function f(a,b){a&&(a.style.display=b)}var g=b.prototype;return b.create.status=function(){var a=c.getQueryElement(this.options.status);a&&(this.statusElement=a,this.statusEventElements={request:a.querySelector(".infinite-scroll-request"),error:a.querySelector(".infinite-scroll-error"),last:a.querySelector(".infinite-scroll-last")},this.on("request",this.showRequestStatus),this.on("error",this.showErrorStatus),this.on("last",this.showLastStatus),this.bindHideStatus("on"))},g.bindHideStatus=function(a){var b=this.options.append?"append":"load";this[a](b,this.hideAllStatus)},g.showRequestStatus=function(){this.showStatus("request")},g.showErrorStatus=function(){this.showStatus("error")},g.showLastStatus=function(){this.showStatus("last"),this.bindHideStatus("off")},g.showStatus=function(a){e(this.statusElement),this.hideStatusEventElements();var b=this.statusEventElements[a];e(b)},g.hideAllStatus=function(){d(this.statusElement),this.hideStatusEventElements()},g.hideStatusEventElements=function(){for(var a in this.statusEventElements){var b=this.statusEventElements[a];d(b)}},b}),function(a,b){"function"==typeof define&&define.amd?define(["infinite-scroll/js/core","infinite-scroll/js/page-load","infinite-scroll/js/scroll-watch","infinite-scroll/js/history","infinite-scroll/js/button","infinite-scroll/js/status"],b):"object"==typeof module&&module.exports&&(module.exports=b(require("./core"),require("./page-load"),require("./scroll-watch"),require("./history"),require("./button"),require("./status")))}(window,function(a){return a}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("imagesloaded/imagesloaded",["ev-emitter/ev-emitter"],function(c){return b(a,c)}):"object"==typeof module&&module.exports?module.exports=b(a,require("ev-emitter")):a.imagesLoaded=b(a,a.EvEmitter)}("undefined"!=typeof window?window:this,function(a,b){function c(a,b){for(var c in b)a[c]=b[c];return a}function d(a){if(Array.isArray(a))return a;var b="object"==typeof a&&"number"==typeof a.length;return b?j.call(a):[a]}function e(a,b,f){if(!(this instanceof e))return new e(a,b,f);var g=a;return"string"==typeof a&&(g=document.querySelectorAll(a)),g?(this.elements=d(g),this.options=c({},this.options),"function"==typeof b?f=b:c(this.options,b),f&&this.on("always",f),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void i.error("Bad element for imagesLoaded "+(g||a))}function f(a){this.img=a}function g(a,b){this.url=a,this.element=b,this.img=new Image}var h=a.jQuery,i=a.console,j=Array.prototype.slice;e.prototype=Object.create(b.prototype),e.prototype.options={},e.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},e.prototype.addElementImages=function(a){"IMG"==a.nodeName&&this.addImage(a),this.options.background===!0&&this.addElementBackgroundImages(a);var b=a.nodeType;if(b&&k[b]){for(var c=a.querySelectorAll("img"),d=0;d<c.length;d++){var e=c[d];this.addImage(e)}if("string"==typeof this.options.background){var f=a.querySelectorAll(this.options.background);for(d=0;d<f.length;d++){var g=f[d];this.addElementBackgroundImages(g)}}}};var k={1:!0,9:!0,11:!0};return e.prototype.addElementBackgroundImages=function(a){var b=getComputedStyle(a);if(b)for(var c=/url\((['"])?(.*?)\1\)/gi,d=c.exec(b.backgroundImage);null!==d;){var e=d&&d[2];e&&this.addBackground(e,a),d=c.exec(b.backgroundImage)}},e.prototype.addImage=function(a){var b=new f(a);this.images.push(b)},e.prototype.addBackground=function(a,b){var c=new g(a,b);this.images.push(c)},e.prototype.check=function(){function a(a,c,d){setTimeout(function(){b.progress(a,c,d)})}var b=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(b){b.once("progress",a),b.check()}):void this.complete()},e.prototype.progress=function(a,b,c){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!a.isLoaded,this.emitEvent("progress",[this,a,b]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,a),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&i&&i.log("progress: "+c,a,b)},e.prototype.complete=function(){var a=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(a,[this]),this.emitEvent("always",[this]),this.jqDeferred){var b=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[b](this)}},f.prototype=Object.create(b.prototype),f.prototype.check=function(){var a=this.getIsImageComplete();return a?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},f.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},f.prototype.confirm=function(a,b){this.isLoaded=a,this.emitEvent("progress",[this,this.img,b])},f.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},f.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},f.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},f.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},g.prototype=Object.create(f.prototype),g.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var a=this.getIsImageComplete();a&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},g.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},g.prototype.confirm=function(a,b){this.isLoaded=a,this.emitEvent("progress",[this,this.element,b])},e.makeJQueryPlugin=function(b){b=b||a.jQuery,b&&(h=b,h.fn.imagesLoaded=function(a,b){var c=new e(this,a,b);return c.jqDeferred.promise(h(this))})},e.makeJQueryPlugin(),e});