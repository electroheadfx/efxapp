!function(a,b){"use strict";function c(a){return Array.prototype.slice.call(a)}function d(a){return"object"==typeof a[0]||0===a.length}function e(a,b){var c=Object.getOwnPropertyDescriptor(h.prototype,b);return c?"undefined"!=typeof c.get:!1}function f(a,b){var c=Object.getOwnPropertyDescriptor(h.prototype,b);return c?"undefined"!=typeof c.set:!1}function g(a,b){return"function"==typeof a[b]}if(a){var h=function(){function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b,c,d){if(!(b>=1)){for(var e=a.width,f=a.height,g=Math.max(d.width,Math.min(c.width,Math.round(a.width*b))),h=Math.max(d.height,Math.min(c.height,Math.round(a.height*b))),i=hb(a),j=void 0,k=void 0;e>g&&f>h;)j=document.createElement("canvas"),e=Math.round(.5*i.width),f=Math.round(.5*i.height),g>e&&(e=g),h>f&&(f=h),j.width=e,j.height=f,k=j.getContext("2d"),k.drawImage(i,0,0,e,f),i=hb(j);a.width=g,a.height=h,k=a.getContext("2d"),k.drawImage(i,0,0,g,h)}}!function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:b};var d=document.createEvent("CustomEvent");return d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail),d}return"function"==typeof window.CustomEvent?!1:(a.prototype=window.Event.prototype,void(window.CustomEvent=a))}();var d=function(a,b,c){var e,f,g=document.createElement("img");if(g.onerror=b,g.onload=function(){!f||c&&c.noRevoke||d.revokeObjectURL(f),b&&b(d.scale(g,c))},d.isInstanceOf("Blob",a)||d.isInstanceOf("File",a))e=f=d.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,c&&c.crossOrigin&&(g.crossOrigin=c.crossOrigin)}return e?(g.src=e,g):d.readFile(a,function(a){var c=a.target;c&&c.result?g.src=c.result:b&&b(a)})},e=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;d.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},d.transformCoordinates=function(){},d.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},d.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},d.hasCanvasOption=function(a){return a.canvas||a.crop||!!a.aspectRatio},d.scale=function(a,c){function e(){var a=Math.max((i||v)/v,(j||w)/w);a>1&&(v*=a,w*=a)}function f(){var a=Math.min((g||v)/v,(h||w)/w);1>a&&(v*=a,w*=a)}c=c||{};var g,h,i,j,k,l,m,n,o,p,q,r=document.createElement("canvas"),s=a.getContext||d.hasCanvasOption(c)&&r.getContext,t=a.naturalWidth||a.width,u=a.naturalHeight||a.height,v=t,w=u;if(s&&(c=d.getTransformedOptions(a,c),m=c.left||0,n=c.top||0,c.sourceWidth?(k=c.sourceWidth,c.right!==b&&c.left===b&&(m=t-k-c.right)):k=t-m-(c.right||0),c.sourceHeight?(l=c.sourceHeight,c.bottom!==b&&c.top===b&&(n=u-l-c.bottom)):l=u-n-(c.bottom||0),v=k,w=l),g=c.maxWidth,h=c.maxHeight,i=c.minWidth,j=c.minHeight,s&&g&&h&&c.crop?(v=g,w=h,q=k/l-g/h,0>q?(l=h*k/g,c.top===b&&c.bottom===b&&(n=(u-l)/2)):q>0&&(k=g*l/h,c.left===b&&c.right===b&&(m=(t-k)/2))):((c.contain||c.cover)&&(i=g=g||i,j=h=h||j),c.cover?(f(),e()):(e(),f())),s){if(o=c.pixelRatio,o>1&&(r.style.width=v+"px",r.style.height=w+"px",v*=o,w*=o,r.getContext("2d").scale(o,o)),p=c.downsamplingRatio,p>0&&1>p&&k>v&&l>w)for(;k*p>v;)r.width=k*p,r.height=l*p,d.renderImageToCanvas(r,a,m,n,k,l,0,0,r.width,r.height),k=r.width,l=r.height,a=document.createElement("canvas"),a.width=k,a.height=l,d.renderImageToCanvas(a,r,0,0,k,l,0,0,k,l);return r.width=v,r.height=w,d.transformCoordinates(r,c),d.renderImageToCanvas(r,a,m,n,k,l,0,0,v,w)}return a.width=v,a.height=w,a},d.createObjectURL=function(a){return e?e.createObjectURL(a):!1},d.revokeObjectURL=function(a){return e?e.revokeObjectURL(a):!1},d.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1};var f=d.hasCanvasOption,g=d.transformCoordinates,h=d.getTransformedOptions;d.hasCanvasOption=function(a){return!!a.orientation||f.call(d,a)},d.transformCoordinates=function(a,b){g.call(d,a,b);var c=a.getContext("2d"),e=a.width,f=a.height,h=a.style.width,i=a.style.height,j=b.orientation;if(j&&!(j>8))switch(j>4&&(a.width=f,a.height=e,a.style.width=i,a.style.height=h),j){case 2:c.translate(e,0),c.scale(-1,1);break;case 3:c.translate(e,f),c.rotate(Math.PI);break;case 4:c.translate(0,f),c.scale(1,-1);break;case 5:c.rotate(.5*Math.PI),c.scale(1,-1);break;case 6:c.rotate(.5*Math.PI),c.translate(0,-f);break;case 7:c.rotate(.5*Math.PI),c.translate(e,-f),c.scale(-1,1);break;case 8:c.rotate(-.5*Math.PI),c.translate(-e,0)}},d.getTransformedOptions=function(a,b){var c,e,f=h.call(d,a,b),g=f.orientation;if(!g||g>8||1===g)return f;c={};for(e in f)f.hasOwnProperty(e)&&(c[e]=f[e]);switch(f.orientation){case 2:c.left=f.right,c.right=f.left;break;case 3:c.left=f.right,c.top=f.bottom,c.right=f.left,c.bottom=f.top;break;case 4:c.top=f.bottom,c.bottom=f.top;break;case 5:c.left=f.top,c.top=f.left,c.right=f.bottom,c.bottom=f.right;break;case 6:c.left=f.top,c.top=f.right,c.right=f.bottom,c.bottom=f.left;break;case 7:c.left=f.bottom,c.top=f.right,c.right=f.top,c.bottom=f.left;break;case 8:c.left=f.bottom,c.top=f.left,c.right=f.top,c.bottom=f.right}return f.orientation>4&&(c.maxWidth=f.maxHeight,c.maxHeight=f.maxWidth,c.minWidth=f.minHeight,c.minHeight=f.minWidth,c.sourceWidth=f.sourceHeight,c.sourceHeight=f.sourceWidth),c};var i=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);d.blobSlice=i&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},d.metaDataParsers={jpeg:{65505:[]}},d.parseMetaData=function(a,b,c){c=c||{};var e=this,f=c.maxMetaDataSize||262144,g={},h=!(window.DataView&&a&&a.size>=12&&"image/jpeg"===a.type&&d.blobSlice);(h||!d.readFile(d.blobSlice.call(a,0,f),function(a){if(a.target.error)return void b(g);var f,h,i,j,k=a.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;n>m&&(f=l.getUint16(m),f>=65504&&65519>=f||65534===f)&&(h=l.getUint16(m+2)+2,!(m+h>l.byteLength));){if(i=d.metaDataParsers.jpeg[f])for(j=0;j<i.length;j+=1)i[j].call(e,l,m,h,g,c);m+=h,o=m}!c.disableImageHead&&o>6&&(g.imageHead=k.slice?k.slice(0,o):new Uint8Array(k).subarray(0,o))}b(g)},"readAsArrayBuffer"))&&b(g)},d.ExifMap=function(){return this},d.ExifMap.prototype.map={Orientation:274},d.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},d.getExifThumbnail=function(a,b,c){var d,e,f;if(c&&!(b+c>a.byteLength)){for(d=[],e=0;c>e;e+=1)f=a.getUint8(b+e),d.push((16>f?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")}},d.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},d.exifTagTypes[7]=d.exifTagTypes[1],d.getExifValue=function(a,b,c,e,f,g){var h,i,j,k,l,m,n=d.exifTagTypes[e];if(n&&(h=n.size*f,i=h>4?b+a.getUint32(c+8,g):c+8,!(i+h>a.byteLength))){if(1===f)return n.getValue(a,i,g);for(j=[],k=0;f>k;k+=1)j[k]=n.getValue(a,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&(m=j[k],"\x00"!==m);k+=1)l+=m;return l}return j}},d.parseExifTag=function(a,b,c,e,f){var g=a.getUint16(c,e);f.exif[g]=d.getExifValue(a,b,c,a.getUint16(c+2,e),a.getUint32(c+4,e),e)},d.parseExifTags=function(a,b,c,d,e){var f,g,h;if(!(c+6>a.byteLength||(f=a.getUint16(c,d),g=c+2+12*f,g+4>a.byteLength))){for(h=0;f>h;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)}},d.parseExifData=function(a,b,c,e,f){if(!f.disableExif){var g,h,i,j=b+10;if(1165519206===a.getUint32(b+4)&&!(j+8>a.byteLength)&&0===a.getUint16(b+8)){switch(a.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return}42===a.getUint16(j+2,g)&&(h=a.getUint32(j+4,g),e.exif=new d.ExifMap,h=d.parseExifTags(a,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=d.parseExifTags(a,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=d.getExifThumbnail(a,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&d.parseExifTags(a,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&d.parseExifTags(a,j,j+e.exif[34853],g,e))}}},d.metaDataParsers.jpeg[65505].push(d.parseExifData);var j=function(){var a=[],c=[],d=[],e="transform",f=window.getComputedStyle(document.documentElement,""),g=(Array.prototype.slice.call(f).join("").match(/-(moz|webkit|ms)-/)||""===f.OLink&&["","o"])[1];"webkit"===g&&(e="webkitTransform");var h=function(a,c,d){var e=a;if(e.length!==b){for(var f={chainers:[],then:function(a){return this.snabbt(a)},snabbt:function(a){var b=this.chainers.length;return this.chainers.forEach(function(c,d){c.snabbt(i(a,d,b))}),f},setValue:function(a){return this.chainers.forEach(function(b){b.setValue(a)}),f},finish:function(){return this.chainers.forEach(function(a){a.finish()}),f},rollback:function(){return this.chainers.forEach(function(a){a.rollback()}),f}},g=0,h=e.length;h>g;++g)f.chainers.push("string"==typeof c?j(e[g],c,i(d,g,h)):j(e[g],i(c,g,h),d));return f}return"string"==typeof c?j(e,c,i(d,0,1)):j(e,i(c,0,1),d)},i=function(a,b,c){if(!a)return a;var d=Y(a);X(a.delay)&&(d.delay=a.delay(b,c)),X(a.callback)&&(d.complete=function(){a.callback.call(this,b,c)});var e=X(a.allDone),f=X(a.complete);(f||e)&&(d.complete=function(){f&&a.complete.call(this,b,c),e&&b==c-1&&a.allDone()}),X(a.valueFeeder)&&(d.valueFeeder=function(d,e){return a.valueFeeder(d,e,b,c)}),X(a.easing)&&(d.easing=function(d){return a.easing(d,b,c)});var g=["position","rotation","skew","rotationPost","scale","width","height","opacity","fromPosition","fromRotation","fromSkew","fromRotationPost","fromScale","fromWidth","fromHeight","fromOpacity","transformOrigin","duration","delay"];return g.forEach(function(e){X(a[e])&&(d[e]=a[e](b,c))}),d},j=function(a,b,d){function e(b){return o.tick(b),o.updateElement(a),o.isStopped()?void 0:o.completed()?void(f.loop>1&&!o.isStopped()?(f.loop-=1,o.restart(),w(e)):(f.complete&&f.complete.call(a),p.length&&(f=p.pop(),h=t(f,j,!0),j=t(f,Y(j)),f=u(h,j,f),o=y(f),c.push([a,o]),o.tick(b),w(e)))):w(e)}if("attention"===b)return k(a,d);if("stop"===b)return l(a);if("detach"===b)return n(a);var f=b;q();var g=s(a),h=g;h=t(f,h,!0);var j=Y(g);j=t(f,j);var m=u(h,j,f),o=y(m);c.push([a,o]),o.updateElement(a,!0);var p=[],r={snabbt:function(a){return p.unshift(i(a,0,1)),r},then:function(a){return this.snabbt(a)}};return w(e),f.manual?o:r},k=function(a,b){function d(c){f.tick(c),f.updateElement(a),f.completed()?(b.callback&&b.callback(a),b.loop&&b.loop>1&&(b.loop--,f.restart(),w(d))):w(d)}var e=t(b,R({}));b.movement=e;var f=z(b);c.push([a,f]),w(d)},l=function(a){for(var b=0,d=c.length;d>b;++b){var e=c[b],f=e[0],g=e[1];f===a&&g.stop()}},m=function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c][0]===b)return c;return-1},n=function(a){var b,e,f=[],g=c.concat(d),h=g.length;for(e=0;h>e;++e)b=g[e][0],(a.contains(b)||a===b)&&f.push(b);for(h=f.length,e=0;h>e;++e)o(f[e])},o=function(a){l(a);var b=m(c,a);b>=0&&c.splice(b,1),b=m(d,a),b>=0&&d.splice(b,1)},p=function(a,b){for(var c=0,d=a.length;d>c;++c){var e=a[c],f=e[0],g=e[1];if(f===b){var h=g.getCurrentState();return g.stop(),h}}},q=function(){d=d.filter(function(a){return r(a[0]).body})},r=function(a){for(var b=a;b.parentNode;)b=b.parentNode;return b},s=function(a){var b=p(c,a);return b?b:p(d,a)},t=function(a,b,c){b||(b=R({position:[0,0,0],rotation:[0,0,0],rotationPost:[0,0,0],scale:[1,1],skew:[0,0]}));var d="position",e="rotation",f="skew",g="rotationPost",h="scale",i="scalePost",j="width",k="height",l="opacity";return c&&(d="fromPosition",e="fromRotation",f="fromSkew",g="fromRotationPost",h="fromScale",i="fromScalePost",j="fromWidth",k="fromHeight",l="fromOpacity"),b.position=U(a[d],b.position),b.rotation=U(a[e],b.rotation),b.rotationPost=U(a[g],b.rotationPost),b.skew=U(a[f],b.skew),b.scale=U(a[h],b.scale),b.scalePost=U(a[i],b.scalePost),b.opacity=a[l],b.width=a[j],b.height=a[k],b},u=function(a,b,c){return c.startState=a,c.endState=b,c},v=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1e3/60)},w=function(b){0===a.length&&v(x),a.push(b)},x=function(b){for(var e=a.length,f=0;e>f;++f)a[f](b);a.splice(0,e);var g=c.filter(function(a){return a[1].completed()});d=d.filter(function(a){for(var b=0,c=g.length;c>b;++b)if(a[0]===g[b][0])return!1;return!0}),d=d.concat(g),c=c.filter(function(a){return!a[1].completed()}),0!==a.length&&v(x)},y=function(a){{var c=a.startState,d=a.endState,e=U(a.duration,500),f=U(a.delay,0),g=a.perspective,h=G(U(a.easing,"linear"),a),i=0===e?d.clone():c.clone();a.transformOrigin}i.transformOrigin=a.transformOrigin;var j,k,l=0,m=0,n=!1,o=!1,p=a.manual,q=0,r=f/e;return k=a.valueFeeder?T(a.valueFeeder,c,d,i):S(c,d,i),{stop:function(){n=!0},isStopped:function(){return n},finish:function(a){p=!1;var b=e*q;l=m-b,j=a,h.resetFrom=q},rollback:function(a){p=!1,k.setReverse();var b=e*(1-q);l=m-b,j=a,h.resetFrom=q},restart:function(){l=b,h.resetFrom(0)},tick:function(a){if(!n){if(p)return m=a,void this.updateCurrentTransform();if(l||(l=a),a-l>f){o=!0,m=a-f;var b=Math.min(Math.max(0,m-l),e);h.tick(b/e),this.updateCurrentTransform(),this.completed()&&j&&j()}}},getCurrentState:function(){return i},setValue:function(a){o=!0,q=Math.min(Math.max(a,1e-4),1+r)},updateCurrentTransform:function(){var a=h.getValue();if(p){var b=Math.max(1e-5,q-r);h.tick(b),a=h.getValue()}k.tween(a)},completed:function(){return n?!0:0===l?!1:h.completed()},updateElement:function(a,b){if(o||b){var c=k.asMatrix(),d=k.getProperties();V(a,c,g),W(a,d)}}}},z=function(a){var c=a.movement;a.initialVelocity=.1,a.equilibriumPosition=0;var d=E(a),e=!1,f=c.position,g=c.rotation,h=c.rotationPost,i=c.scale,j=c.skew,k=R({position:f?[0,0,0]:b,rotation:g?[0,0,0]:b,rotationPost:h?[0,0,0]:b,scale:i?[0,0]:b,skew:j?[0,0]:b});return{stop:function(){e=!0},isStopped:function(){return e},tick:function(){e||d.equilibrium||(d.tick(),this.updateMovement())},updateMovement:function(){var a=d.getValue();f&&(k.position[0]=c.position[0]*a,k.position[1]=c.position[1]*a,k.position[2]=c.position[2]*a),g&&(k.rotation[0]=c.rotation[0]*a,k.rotation[1]=c.rotation[1]*a,k.rotation[2]=c.rotation[2]*a),h&&(k.rotationPost[0]=c.rotationPost[0]*a,k.rotationPost[1]=c.rotationPost[1]*a,k.rotationPost[2]=c.rotationPost[2]*a),i&&(k.scale[0]=1+c.scale[0]*a,k.scale[1]=1+c.scale[1]*a),j&&(k.skew[0]=c.skew[0]*a,k.skew[1]=c.skew[1]*a)},updateElement:function(a){V(a,k.asMatrix()),W(a,k.getProperties())},getCurrentState:function(){return k},completed:function(){return d.equilibrium||e},restart:function(){d=E(a)}}},A=function(a){return a},B=function(a){return(Math.cos(a*Math.PI+Math.PI)+1)/2},C=function(a){return a*a},D=function(a){return-Math.pow(a-1,2)+1},E=function(a){var b=U(a.startPosition,0),c=U(a.equilibriumPosition,1),d=U(a.initialVelocity,0),e=U(a.springConstant,.8),f=U(a.springDeceleration,.9),g=U(a.springMass,10),h=!1;return{tick:function(a){if(0!==a&&!h){var i=-(b-c)*e,j=i/g;d+=j,b+=d,d*=f,Math.abs(b-c)<.001&&Math.abs(d)<.001&&(h=!0)}},resetFrom:function(a){b=a,d=0},getValue:function(){return h?c:b},completed:function(){return h}}},F={linear:A,ease:B,easeIn:C,easeOut:D},G=function(a,b){if("spring"==a)return E(b);var c=a;X(a)||(c=F[a]);var d,e=c,f=0;return{tick:function(a){f=e(a),d=a},resetFrom:function(){d=0},getValue:function(){return f},completed:function(){return d>=1?d:!1}}},H=function(a,b,c,d){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b,a[13]=c,a[14]=d,a[15]=1},I=function(a,b){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=Math.cos(b),a[6]=-Math.sin(b),a[7]=0,a[8]=0,a[9]=Math.sin(b),a[10]=Math.cos(b),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},J=function(a,b){a[0]=Math.cos(b),a[1]=0,a[2]=Math.sin(b),a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=-Math.sin(b),a[9]=0,a[10]=Math.cos(b),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},K=function(a,b){a[0]=Math.cos(b),a[1]=-Math.sin(b),a[2]=0,a[3]=0,a[4]=Math.sin(b),a[5]=Math.cos(b),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},L=function(a,b,c){a[0]=1,a[1]=Math.tan(b),a[2]=0,a[3]=0,a[4]=Math.tan(c),a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},M=function(a,b,c){a[0]=b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},N=function(a){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1},O=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]},P=function(){var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16);return N(a),{data:a,asCSS:function(){for(var b="matrix3d(",c=0;15>c;++c)b+=Math.abs(a[c])<1e-4?"0,":a[c].toFixed(10)+",";return b+=Math.abs(a[15])<1e-4?"0)":a[15].toFixed(10)+")"},clear:function(){N(a)},translate:function(d,e,f){return O(a,b),H(c,d,e,f),Q(b,c,a),this},rotateX:function(d){return O(a,b),I(c,d),Q(b,c,a),this},rotateY:function(d){return O(a,b),J(c,d),Q(b,c,a),this},rotateZ:function(d){return O(a,b),K(c,d),Q(b,c,a),this},scale:function(d,e){return O(a,b),M(c,d,e),Q(b,c,a),this},skew:function(d,e){return O(a,b),L(c,d,e),Q(b,c,a),this}}},Q=function(a,b,c){return c[0]=a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],c[1]=a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],c[2]=a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],c[3]=a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],c[4]=a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],c[5]=a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],c[6]=a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],c[7]=a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],c[8]=a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],c[9]=a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],c[10]=a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],c[11]=a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],c[12]=a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],c[13]=a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],c[14]=a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],c[15]=a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15],c},R=function(a){var c=P(),d={opacity:b,width:b,height:b};return{position:a.position,rotation:a.rotation,rotationPost:a.rotationPost,skew:a.skew,scale:a.scale,scalePost:a.scalePost,opacity:a.opacity,width:a.width,height:a.height,clone:function(){return R({position:this.position?this.position.slice(0):b,rotation:this.rotation?this.rotation.slice(0):b,rotationPost:this.rotationPost?this.rotationPost.slice(0):b,skew:this.skew?this.skew.slice(0):b,scale:this.scale?this.scale.slice(0):b,scalePost:this.scalePost?this.scalePost.slice(0):b,height:this.height,width:this.width,opacity:this.opacity})},asMatrix:function(){var a=c;return a.clear(),this.transformOrigin&&a.translate(-this.transformOrigin[0],-this.transformOrigin[1],-this.transformOrigin[2]),this.scale&&a.scale(this.scale[0],this.scale[1]),this.skew&&a.skew(this.skew[0],this.skew[1]),this.rotation&&(a.rotateX(this.rotation[0]),a.rotateY(this.rotation[1]),a.rotateZ(this.rotation[2])),this.position&&a.translate(this.position[0],this.position[1],this.position[2]),this.rotationPost&&(a.rotateX(this.rotationPost[0]),a.rotateY(this.rotationPost[1]),a.rotateZ(this.rotationPost[2])),this.scalePost&&a.scale(this.scalePost[0],this.scalePost[1]),this.transformOrigin&&a.translate(this.transformOrigin[0],this.transformOrigin[1],this.transformOrigin[2]),a},getProperties:function(){return d.opacity=this.opacity,d.width=this.width+"px",d.height=this.height+"px",d}}},S=function(a,c,d){var e=a,f=c,g=d,h=f.position!==b,i=f.rotation!==b,j=f.rotationPost!==b,k=f.scale!==b,l=f.skew!==b,m=f.width!==b,n=f.height!==b,o=f.opacity!==b;return{tween:function(a){if(h){var b=f.position[0]-e.position[0],c=f.position[1]-e.position[1],d=f.position[2]-e.position[2];g.position[0]=e.position[0]+a*b,g.position[1]=e.position[1]+a*c,g.position[2]=e.position[2]+a*d}if(i){var p=f.rotation[0]-e.rotation[0],q=f.rotation[1]-e.rotation[1],r=f.rotation[2]-e.rotation[2];g.rotation[0]=e.rotation[0]+a*p,g.rotation[1]=e.rotation[1]+a*q,g.rotation[2]=e.rotation[2]+a*r}if(j){var s=f.rotationPost[0]-e.rotationPost[0],t=f.rotationPost[1]-e.rotationPost[1],u=f.rotationPost[2]-e.rotationPost[2];g.rotationPost[0]=e.rotationPost[0]+a*s,g.rotationPost[1]=e.rotationPost[1]+a*t,g.rotationPost[2]=e.rotationPost[2]+a*u}if(l){var v=f.scale[0]-e.scale[0],w=f.scale[1]-e.scale[1];g.scale[0]=e.scale[0]+a*v,g.scale[1]=e.scale[1]+a*w}if(k){var x=f.skew[0]-e.skew[0],y=f.skew[1]-e.skew[1];g.skew[0]=e.skew[0]+a*x,g.skew[1]=e.skew[1]+a*y}if(m){var z=f.width-e.width;g.width=e.width+a*z}if(n){var A=f.height-e.height;g.height=e.height+a*A}if(o){var B=f.opacity-e.opacity;g.opacity=e.opacity+a*B}},asMatrix:function(){return g.asMatrix()},getProperties:function(){return g.getProperties()},setReverse:function(){var a=e;e=f,f=a}}},T=function(a,c,d,e){var f=a(0,P()),g=c,h=d,i=e,j=!1;return{tween:function(c){j&&(c=1-c),f.clear(),f=a(c,f);var d=h.width-g.width,e=h.height-g.height,k=h.opacity-g.opacity;h.width!==b&&(i.width=g.width+c*d),h.height!==b&&(i.height=g.height+c*e),h.opacity!==b&&(i.opacity=g.opacity+c*k)},asMatrix:function(){return f},getProperties:function(){return i.getProperties()},setReverse:function(){j=!0}}},U=function(a,b){return"undefined"==typeof a?b:a},V=function(a,b,c){var d="";c&&(d="perspective("+c+"px) ");var f=b.asCSS();a.style[e]=d+f},W=function(a,b){for(var c in b)a.style[c]=b[c]},X=function(a){return"function"==typeof a},Y=function(a){if(!a)return a;var b={};for(var c in a)b[c]=a[c];return b};return h.createMatrix=P,h.setElementTransform=V,h}(),k=function(){function a(a,b,c,d,e){if("string"==typeof a)a=document.getElementById(a);else if(!a instanceof HTMLCanvasElement)return;var f,g=a.getContext("2d");try{try{f=g.getImageData(b,c,d,e)}catch(h){throw new Error("unable to access local image data: "+h)}}catch(h){throw new Error("unable to access image data: "+h)}return f}function b(b,d,e,f,g,h){if(!(isNaN(h)||1>h)){h|=0;var i=a(b,d,e,f,g);i=c(i,d,e,f,g,h),b.getContext("2d").putImageData(i,d,e)}}function c(a,b,c,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=a.data,I=i+i+1,J=g-1,K=h-1,L=i+1,M=L*(L+1)/2,N=new d,O=N;for(l=1;I>l;l++)if(O=O.next=new d,l==L)var P=O;O.next=N;var Q=null,R=null;p=o=0;var S=e[i],T=f[i];for(k=0;h>k;k++){for(y=z=A=B=q=r=s=t=0,u=L*(C=H[o]),v=L*(D=H[o+1]),w=L*(E=H[o+2]),x=L*(F=H[o+3]),q+=M*C,r+=M*D,s+=M*E,t+=M*F,O=N,l=0;L>l;l++)O.r=C,O.g=D,O.b=E,O.a=F,O=O.next;for(l=1;L>l;l++)m=o+((l>J?J:l)<<2),q+=(O.r=C=H[m])*(G=L-l),r+=(O.g=D=H[m+1])*G,s+=(O.b=E=H[m+2])*G,t+=(O.a=F=H[m+3])*G,y+=C,z+=D,A+=E,B+=F,O=O.next;for(Q=N,R=P,j=0;g>j;j++)H[o+3]=F=t*S>>T,0!=F?(F=255/F,H[o]=(q*S>>T)*F,H[o+1]=(r*S>>T)*F,H[o+2]=(s*S>>T)*F):H[o]=H[o+1]=H[o+2]=0,q-=u,r-=v,s-=w,t-=x,u-=Q.r,v-=Q.g,w-=Q.b,x-=Q.a,m=p+((m=j+i+1)<J?m:J)<<2,y+=Q.r=H[m],z+=Q.g=H[m+1],A+=Q.b=H[m+2],B+=Q.a=H[m+3],q+=y,r+=z,s+=A,t+=B,Q=Q.next,u+=C=R.r,v+=D=R.g,w+=E=R.b,x+=F=R.a,y-=C,z-=D,A-=E,B-=F,R=R.next,o+=4;p+=g}for(j=0;g>j;j++){for(z=A=B=y=r=s=t=q=0,o=j<<2,u=L*(C=H[o]),v=L*(D=H[o+1]),w=L*(E=H[o+2]),x=L*(F=H[o+3]),q+=M*C,r+=M*D,s+=M*E,t+=M*F,O=N,l=0;L>l;l++)O.r=C,O.g=D,O.b=E,O.a=F,O=O.next;for(n=g,l=1;i>=l;l++)o=n+j<<2,q+=(O.r=C=H[o])*(G=L-l),r+=(O.g=D=H[o+1])*G,s+=(O.b=E=H[o+2])*G,t+=(O.a=F=H[o+3])*G,y+=C,z+=D,A+=E,B+=F,O=O.next,K>l&&(n+=g);for(o=j,Q=N,R=P,k=0;h>k;k++)m=o<<2,H[m+3]=F=t*S>>T,F>0?(F=255/F,H[m]=(q*S>>T)*F,H[m+1]=(r*S>>T)*F,H[m+2]=(s*S>>T)*F):H[m]=H[m+1]=H[m+2]=0,q-=u,r-=v,s-=w,t-=x,u-=Q.r,v-=Q.g,w-=Q.b,x-=Q.a,m=j+((m=k+L)<K?m:K)*g<<2,q+=y+=Q.r=H[m],r+=z+=Q.g=H[m+1],s+=A+=Q.b=H[m+2],t+=B+=Q.a=H[m+3],Q=Q.next,u+=C=R.r,v+=D=R.g,w+=E=R.b,x+=F=R.a,y-=C,z-=D,A-=E,B-=F,R=R.next,o+=g}return a}function d(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return b}();HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){for(var d=atob(this.toDataURL(b,c).split(",")[1]),e=d.length,f=new Uint8Array(e),g=0;e>g;g++)f[g]=d.charCodeAt(g);a(new Blob([f],{type:b||"image/png"}))}});var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n=function(a){if("undefined"==typeof a.dataset){var b,c,d={},e=a.attributes;for(b in e)e.hasOwnProperty(b)&&e[b].name&&/^data-[a-z_\-\d]*$/i.test(e[b].name)&&(c=o(e[b].name.substr(5)),d[c]=e[b].value);return d}return a.dataset},o=function(a){return a.replace(/\-./g,function(a){return a.charAt(1).toUpperCase()})},p=function(a){for(var b=[],c=Array.prototype.slice.call(a.attributes),d=c.length,e=0;d>e;e++)b.push({name:c[e].name,value:c[e].value});return b},q=function(a){return{x:"undefined"==typeof a.offsetX?a.layerX:a.offsetX,y:"undefined"==typeof a.offsetY?a.layerY:a.offsetY}},r=function(a,b){var c,d={},e=b||{};for(c in a)a.hasOwnProperty(c)&&(d[c]="undefined"==typeof e[c]?a[c]:e[c]);return d},s={ESC:27,RETURN:13},t={DOWN:["touchstart","pointerdown","mousedown"],MOVE:["touchmove","pointermove","mousemove"],UP:["touchend","touchcancel","pointerup","mouseup"]},u={jpeg:"image/jpeg",jpg:"image/jpeg",jpe:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp"},v=/(\.png|\.bmp|\.gif|\.jpg|\.jpe|\.jpg|\.jpeg)$/,w=function(a,b){var c=document.createElement(a);return b&&(c.className=b),c},x=function(a,b,c){b.forEach(function(b){a.addEventListener(b,c,!1)})},y=function(a,b,c){b.forEach(function(b){a.removeEventListener(b,c,!1)})},z=function(a){var b=a.changedTouches?a.changedTouches[0]:a;if(b)return{x:b.pageX,y:b.pageY}},A=function(a,b){var c=.5,d=.5,e=Math.PI/180*b,f=Math.cos(e),g=Math.sin(e),h=a.x,i=a.y,j=a.x+a.width,k=a.y+a.height,l=f*(h-c)+g*(i-d)+c,m=f*(i-d)-g*(h-c)+d,n=f*(j-c)+g*(k-d)+c,o=f*(k-d)-g*(j-c)+d;n>=l?(a.x=l,a.width=n-l):(a.x=n,a.width=l-n),o>=m?(a.y=m,a.height=o-m):(a.y=o,a.height=m-o)},B=function(a){var b=z(a);return b.x-=window.pageXOffset||document.documentElement.scrollLeft,b.y-=window.pageYOffset||document.documentElement.scrollTop,b},C=function(a){return a.charAt(0).toLowerCase()+a.slice(1)},D=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},E=function(a){return a[a.length-1]},F=function(a,b,c){return Math.max(b,Math.min(c,a))},G=function(a,b){if(!b)return!1;for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},H=function(a){var c=arguments.length>1&&arguments[1]!==b?arguments[1]:"POST",d=arguments[2],e=arguments[3],f=arguments[4],g=arguments[5],h=arguments[6],i=new XMLHttpRequest;f&&i.upload.addEventListener("progress",function(a){f(a.loaded,a.total)}),i.open(c,a,!0),e&&e(i,d),i.onreadystatechange=function(){if(4===i.readyState&&i.status>=200&&i.status<300){var a=i.responseText;if(!a.length)return void g();if(-1!==a.indexOf("Content-Length"))return void h("file-too-big");var b=void 0;try{b=JSON.parse(i.responseText)}catch(c){}if("object"===("undefined"==typeof b?"undefined":m(b))&&"failure"===b.status)return void h(b.message);g(b||a)}else if(4===i.readyState){var d=void 0;try{d=JSON.parse(i.responseText)}catch(c){}if("object"===("undefined"==typeof d?"undefined":m(d))&&"failure"===d.status)return void h(d.message);h("fail")}},i.send(d)},I=function(a){a&&(a.style.webkitTransform="",a.style.transform="")},J=function(a){return a/1e6},K=function(){var a=[],b=void 0,c=void 0;for(b in u)u.hasOwnProperty(b)&&(c=u[b],-1==a.indexOf(c)&&a.push(c));return a},L=function(a){return"image/jpeg"===a},M=function(a){var b=void 0;for(b in u)if(u.hasOwnProperty(b)&&u[b]===a)return b;return a},N=function(a){var b=void 0;for(b in u)if(u.hasOwnProperty(b)&&-1!==a.indexOf(u[b]))return u[b];return null},O=function(a){return a.split("/").pop().split("?").shift()},P=function(a){var c=arguments.length>1&&arguments[1]!==b?arguments[1]:"";return(c+a).slice(-c.length)},Q=function(a){return a.getFullYear()+"-"+P(a.getMonth()+1,"00")+"-"+P(a.getDate(),"00")+"_"+P(a.getHours(),"00")+"-"+P(a.getMinutes(),"00")+"-"+P(a.getSeconds(),"00")},R=function(a){return"undefined"==typeof a.name?Q(new Date)+"."+M(S(a)):a.name},S=function(a){return a.type||"image/jpeg"},T=function(a){if("string"!=typeof a)return Q(new Date);var b=O(a);return b.split(".").shift()},U=function(a,b){return"lastModified"in File.prototype?a.lastModified=new Date:a.lastModifiedDate=new Date,a.name=b,a},V=function(a){return/^data:image/.test(a)},W=function(a,b,c,d,e,f){a=""+a+(-1!==a.indexOf("?")?"&":"?")+"url="+d;var g=new XMLHttpRequest;g.open("GET",a,!0),b(g),g.responseType="json",g.onload=function(){return"failure"===this.response.status?void e(this.response.message):void X(this.response.body,c,f)},g.send()},X=function(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a,!0),b(e),e.responseType="blob",e.onload=function(){if(e.status>=200&&e.status<300){var b=O(a),f=N(this.response.type);v.test(b)||(b+="."+M(f));var g=U(this.response,b);c(rb(g,f))}else d(e.status+": "+e.statusText)},e.onerror=function(){d()},e.send()},Y=function(a){var b=a.split(",")[1],c=b.replace(/\s/g,"");return atob(c)},Z=function(a,b){for(var c=Y(a),d=new ArrayBuffer(c.length),e=new Uint8Array(d),f=0;f<c.length;f++)e[f]=c.charCodeAt(f);var g=ub(a);return"undefined"==typeof b&&(b=Q(new Date)+"."+M(g)),U($(d,g),b)},$=function(a,b){var c=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(c){var d=new c;return d.append(a),d.getBlob(b)}return new Blob([a],{type:b})},_=function(a,b,c){var e="string"==typeof a?0!==a.indexOf("data:image"):!0;d.parseMetaData(a,function(f){var g={canvas:!0,crossOrigin:e};
b&&(g.maxWidth=b.width,g.maxHeight=b.height),f.exif&&(g.orientation=f.exif.get("Orientation")),d(a,function(a){return"error"===a.type?void c():void c(a,f)},g)})},ab=function(a,b,c){var d,e,f,g,h=b/a;return c>h?(g=b,f=g/c,d=.5*(a-f),e=0):(f=a,g=f*c,d=0,e=.5*(b-g)),{x:d,y:e,height:g,width:f}},bb=function(a){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:{},e=arguments[2],f=w("canvas"),g=d.rotation,h=d.crop,i=d.size,j=d.filters,k=d.minSize;if(h){var l=g%180!==0,m={width:l?a.height:a.width,height:l?a.width:a.height};h.x<0&&(h.x=0),h.y<0&&(h.y=0),h.width>m.width&&(h.width=m.width),h.height>m.height&&(h.height=m.height),h.y+h.height>m.height&&(h.y=Math.max(0,m.height-h.height)),h.x+h.width>m.width&&(h.x=Math.max(0,m.width-h.width));var n=h.x/m.width,o=h.y/m.height,p=h.width/m.width,q=h.height/m.height;f.width=h.width,f.height=h.height;var r=f.getContext("2d");90===g?(r.translate(.5*f.width,.5*f.height),r.rotate(-90*Math.PI/180),r.drawImage(a,(1-o)*a.width-a.width*q,h.x,h.height,h.width,.5*-f.height,.5*-f.width,f.height,f.width)):180===g?(r.translate(.5*f.width,.5*f.height),r.rotate(-180*Math.PI/180),r.drawImage(a,(1-(n+p))*m.width,(1-(o+q))*m.height,p*m.width,q*m.height,.5*-f.width,.5*-f.height,f.width,f.height)):270===g?(r.translate(.5*f.width,.5*f.height),r.rotate(-270*Math.PI/180),r.drawImage(a,h.y,(1-n)*a.height-a.height*p,h.height,h.width,.5*-f.height,.5*-f.width,f.height,f.width)):r.drawImage(a,h.x,h.y,h.width,h.height,0,0,f.width,f.height)}if(i){var s=i.width/f.width,t=i.height/f.height,u=Math.min(s,t);c(f,u,i,k),j.sharpen>0&&db(f,fb(j.sharpen))}e(f)},cb=function(a){var b=a.getContext("2d");return b.getImageData(0,0,a.width,a.height)},db=function(a,b){var c=a.getContext("2d");c.putImageData(b(cb(a),a.width,a.height),0,0)},eb=function(a,b,c){var d=document.createElement("canvas");d.width=a,d.height=b;var e=d.getContext("2d"),f=e.createImageData(d.width,d.height);return c&&f.set(c.data),f},fb=function(a){return function(b,c,d){for(var e=[0,-1,0,-1,5,-1,0,-1,0],f=Math.round(Math.sqrt(e.length)),g=.5*f|0,h=eb(c,d),i=h.data,j=b.data,k=d,l=void 0;k--;)for(l=c;l--;){for(var m=k,n=l,o=4*(k*c+l),p=0,q=0,r=0,s=0,t=0;f>t;t++)for(var u=0;f>u;u++){var v=m+t-g,w=n+u-g;if(v>=0&&d>v&&w>=0&&c>w){var x=4*(v*c+w),y=e[t*f+u];p+=j[x]*y,q+=j[x+1]*y,r+=j[x+2]*y,s+=j[x+3]*y}}i[o]=p*a+j[o]*(1-a),i[o+1]=q*a+j[o+1]*(1-a),i[o+2]=r*a+j[o+2]*(1-a),i[o+3]=j[o+3]}return h}},gb=function(a,b){var c=Math.abs(a.width-b.width),d=Math.abs(a.height-b.height);return Math.max(c,d)},hb=function(a){return ib(a,1)},ib=function(a,b){if(!a)return null;var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=a.width,d.height=a.height,e.drawImage(a,0,0),b>0&&1!==b&&c(d,b,{width:Math.round(a.width*b),height:Math.round(a.height*b)},{width:0,height:0}),d},jb=function(a){return a.width&&a.height},kb=function(a,b){var c=b.getContext("2d");jb(b)?c.drawImage(a,0,0,b.width,b.height):(b.width=a.width,b.height=a.height,c.drawImage(a,0,0))},lb=function(a){k(a,0,0,a.width,a.height,3)},mb=function(a,b){return parseInt(a.width,10)>=b.width&&parseInt(a.height,10)>=b.height},nb=function(a,b,c){return{x:a.x*b,y:a.y*c,width:a.width*b,height:a.height*c}},ob=function(a,b,c){return{x:a.x/b,y:a.y/c,width:a.width/b,height:a.height/c}},pb=function(a){if(a&&""!==a.value){try{a.value=""}catch(b){}if(a.value){var c=document.createElement("form"),d=a.parentNode,e=a.nextSibling;c.appendChild(a),c.reset(),e?d.insertBefore(a,e):d.appendChild(a)}}},qb=function(a){return"object"===("undefined"==typeof value?"undefined":m(value))&&null!==value?JSON.parse(JSON.stringify(a)):a},rb=function(a){var c=arguments.length>1&&arguments[1]!==b?arguments[1]:null;if(!a)return null;var d=a.slice(0,a.size,c||a.type);return d.name=a.name,"lastModified"in File.prototype&&a.lastModified?d.lastModified=new Date(a.lastModified):a.lastModifiedDate&&(d.lastModifiedDate=new Date(a.lastModifiedDate)),d},sb=function(a){var b=qb(a);return b.input.file=rb(a.input.file),b.output.image=hb(a.output.image),b},tb=function(a,c,d){return a&&c?a.toDataURL(c,L(c)&&"number"==typeof d?d/100:b):null},ub=function(a){if(!a)return null;var b=a.substr(0,16).match(/^.+;/);return b.length?b[0].substring(5,b[0].length-1):null},vb=function(a){var c=arguments.length>1&&arguments[1]!==b?arguments[1]:[],d=arguments[2],e=arguments[3],f=arguments[4],g={server:qb(a.server),meta:qb(a.meta),input:{name:a.input.name,type:a.input.type,size:a.input.size,width:a.input.width,height:a.input.height,field:a.input.field}};return G("input",c)&&!f&&(g.input.image=tb(a.input.image,a.input.type)),G("output",c)&&(g.output={name:e?T(a.input.name)+"."+e:a.input.name,type:u[e]||a.input.type,width:a.output.width,height:a.output.height},g.output.image=tb(a.output.image,g.output.type,d),g.output.type=ub(g.output.image),"image/png"===g.output.type&&(g.output.name=T(g.input.name)+".png")),G("actions",c)&&(g.actions=qb(a.actions)),g},wb=function(a,c,d){var e=a.output.image,f=d?T(a.input.name)+"."+d:a.input.name,g=u[d]||a.input.type;"image/png"===g&&(f=T(a.input.name)+".png"),e.toBlob(function(a){if("msSaveBlob"in window.navigator)return void window.navigator.msSaveBlob(a,f);var b=(window.URL||window.webkitURL).createObjectURL(a),c=w("a");c.style.display="none",c.download=f,c.href=b,document.body.appendChild(c),c.click(),setTimeout(function(){document.body.removeChild(c),(window.URL||window.webkitURL).revokeObjectURL(b)},0)},g,"number"==typeof c?c/100:b)},xb=function(a,b,c){var d=c.querySelector(a);d&&(d.style.display=b?"":"none")},yb=function(a){return Array.prototype.slice.call(a)},zb=function(a){a.parentNode.removeChild(a)},Ab=function(a){var b=w("div");return a.parentNode&&(a.nextSibling?a.parentNode.insertBefore(b,a.nextSibling):a.parentNode.appendChild(b)),b.appendChild(a),b},Bb=function(a,b,c,d){var e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}},Cb=function(a,b,c,d,e){var f=Bb(a,b,c,e),g=Bb(a,b,c,d),h=180>=e-d?"0":"1",i=["M",f.x,f.y,"A",c,c,0,h,0,g.x,g.y].join(" ");return i},Db=function(a,b,c,d){return Cb(a,b,c,0,360*d)},Eb=function(){var c={n:function(a,b,c,d){var e,f,g,h,i,j,k,l;return g=a.y+a.height,e=F(b.y,0,g),g-e<c.min.height&&(e=g-c.min.height),i=d?(g-e)/d:a.width,i<c.min.width&&(i=c.min.width,e=g-i*d),k=.5*(i-a.width),h=a.x-k,f=a.x+a.width+k,(0>h||Math.round(f)>Math.round(c.width))&&(l=Math.min(a.x,c.width-(a.x+a.width)),h=a.x-l,f=a.x+a.width+l,i=f-h,j=i*d,e=g-j),{x:h,y:e,width:f-h,height:g-e}},s:function(a,b,c,d){var e,f,g,h,i,j,k,l;return e=a.y,g=F(b.y,e,c.height),g-e<c.min.height&&(g=e+c.min.height),i=d?(g-e)/d:a.width,i<c.min.width&&(i=c.min.width,g=e+i*d),k=.5*(i-a.width),h=a.x-k,f=a.x+a.width+k,(0>h||Math.round(f)>Math.round(c.width))&&(l=Math.min(a.x,c.width-(a.x+a.width)),h=a.x-l,f=a.x+a.width+l,i=f-h,j=i*d,g=e+j),{x:h,y:e,width:f-h,height:g-e}},e:function(a,b,c,d){var e,f,g,h,i,j,k,l;return h=a.x,f=F(b.x,h,c.width),f-h<c.min.width&&(f=h+c.min.width),j=d?(f-h)*d:a.height,j<c.min.height&&(j=c.min.height,f=h+j/d),k=.5*(j-a.height),e=a.y-k,g=a.y+a.height+k,(0>e||Math.round(g)>Math.round(c.height))&&(l=Math.min(a.y,c.height-(a.y+a.height)),e=a.y-l,g=a.y+a.height+l,j=g-e,i=j/d,f=h+i),{x:h,y:e,width:f-h,height:g-e}},w:function d(a,b,c,e){var f,g,h,i,d,j,k,l;return g=a.x+a.width,i=F(b.x,0,g),g-i<c.min.width&&(i=g-c.min.width),j=e?(g-i)*e:a.height,j<c.min.height&&(j=c.min.height,i=g-j/e),k=.5*(j-a.height),f=a.y-k,h=a.y+a.height+k,(0>f||Math.round(h)>Math.round(c.height))&&(l=Math.min(a.y,c.height-(a.y+a.height)),f=a.y-l,h=a.y+a.height+l,j=h-f,d=j/e,i=g-d),{x:i,y:f,width:g-i,height:h-f}},ne:function(a,b,c,d){var e,f,g,h,i,j,k;return h=a.x,g=a.y+a.height,f=F(b.x,h,c.width),f-h<c.min.width&&(f=h+c.min.width),j=d?(f-h)*d:F(g-b.y,c.min.height,g),j<c.min.height&&(j=c.min.height,f=h+j/d),e=a.y-(j-a.height),(0>e||Math.round(g)>Math.round(c.height))&&(k=Math.min(a.y,c.height-(a.y+a.height)),e=a.y-k,j=g-e,i=j/d,f=h+i),{x:h,y:e,width:f-h,height:g-e}},se:function(a,b,c,d){var e,f,g,h,i,j,k;return h=a.x,e=a.y,f=F(b.x,h,c.width),f-h<c.min.width&&(f=h+c.min.width),j=d?(f-h)*d:F(b.y-a.y,c.min.height,c.height-e),j<c.min.height&&(j=c.min.height,f=h+j/d),g=a.y+a.height+(j-a.height),(0>e||Math.round(g)>Math.round(c.height))&&(k=Math.min(a.y,c.height-(a.y+a.height)),g=a.y+a.height+k,j=g-e,i=j/d,f=h+i),{x:h,y:e,width:f-h,height:g-e}},sw:function(a,b,c,d){var e,f,g,h,i,j,k;return f=a.x+a.width,e=a.y,h=F(b.x,0,f),f-h<c.min.width&&(h=f-c.min.width),j=d?(f-h)*d:F(b.y-a.y,c.min.height,c.height-e),j<c.min.height&&(j=c.min.height,h=f-j/d),g=a.y+a.height+(j-a.height),(0>e||Math.round(g)>Math.round(c.height))&&(k=Math.min(a.y,c.height-(a.y+a.height)),g=a.y+a.height+k,j=g-e,i=j/d,h=f-i),{x:h,y:e,width:f-h,height:g-e}},nw:function(a,b,c,d){var e,f,g,h,i,j,k;return f=a.x+a.width,g=a.y+a.height,h=F(b.x,0,f),f-h<c.min.width&&(h=f-c.min.width),j=d?(f-h)*d:F(g-b.y,c.min.height,g),j<c.min.height&&(j=c.min.height,h=f-j/d),e=a.y-(j-a.height),(0>e||Math.round(g)>Math.round(c.height))&&(k=Math.min(a.y,c.height-(a.y+a.height)),e=a.y-k,j=g-e,i=j/d,h=f-i),{x:h,y:e,width:f-h,height:g-e}}};return function(){function d(){var c=arguments.length>0&&arguments[0]!==b?arguments[0]:document.createElement("div");a(this,d),this._element=c,this._interaction=null,this._minWidth=1,this._minHeight=1,this._ratio=null,this._rect={x:0,y:0,width:0,height:0},this._space={width:0,height:0},this._rectChanged=!1,this._init()}return l(d,[{key:"_init",value:function(){this._element.className="slim-crop-area";var a=w("div","grid");this._element.appendChild(a);for(var b in c)if(c.hasOwnProperty(b)){var d=w("button",b);this._element.appendChild(d)}var e=w("button","c");this._element.appendChild(e),x(document,t.DOWN,this)}},{key:"reset",value:function(){this._interaction=null,this._rect={x:0,y:0,width:0,height:0},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"rescale",value:function(a){1!==a&&(this._interaction=null,this._rectChanged=!0,this._rect.x*=a,this._rect.y*=a,this._rect.width*=a,this._rect.height*=a,this._redraw(),this._element.dispatchEvent(new CustomEvent("change")))}},{key:"limit",value:function(a,b){this._space.width=a,this._space.height=b}},{key:"offset",value:function(a,b){this._space.x=a,this._space.y=b}},{key:"resize",value:function(a,b,c,d){this._interaction=null,this._rect={x:F(a,0,this._space.width-this._minWidth),y:F(b,0,this._space.height-this._minHeight),width:F(c,this._minWidth,this._space.width),height:F(d,this._minHeight,this._space.height)},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"handleEvent",value:function(a){switch(a.type){case"touchstart":case"pointerdown":case"mousedown":this._onStartDrag(a);break;case"touchmove":case"pointermove":case"mousemove":this._onDrag(a);break;case"touchend":case"touchcancel":case"pointerup":case"mouseup":this._onStopDrag(a)}}},{key:"_onStartDrag",value:function(a){this._element.contains(a.target)&&(a.preventDefault(),x(document,t.MOVE,this),x(document,t.UP,this),this._interaction={type:a.target.className,offset:B(a)},this._interaction.offset.x-=this._rect.x,this._interaction.offset.y-=this._rect.y,this._element.setAttribute("data-dragging","true"),this._redraw())}},{key:"_onDrag",value:function(a){a.preventDefault();var b=B(a),d=this._interaction.type;"c"===d?(this._rect.x=F(b.x-this._interaction.offset.x,0,this._space.width-this._rect.width),this._rect.y=F(b.y-this._interaction.offset.y,0,this._space.height-this._rect.height)):c[d]&&(this._rect=c[d](this._rect,{x:b.x-this._space.x,y:b.y-this._space.y},{x:0,y:0,width:this._space.width,height:this._space.height,min:{width:this._minWidth,height:this._minHeight}},this._ratio)),this._rectChanged=!0,this._element.dispatchEvent(new CustomEvent("input"))}},{key:"_onStopDrag",value:function(a){a.preventDefault(),y(document,t.MOVE,this),y(document,t.UP,this),this._interaction=null,this._element.setAttribute("data-dragging","false"),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"_redraw",value:function(){var a=this;if(this._rectChanged){var b="translate("+this._rect.x+"px,"+this._rect.y+"px);";this._element.style.cssText="\n					-webkit-transform: "+b+";\n					transform: "+b+";\n					width:"+this._rect.width+"px;\n					height:"+this._rect.height+"px;\n				",this._rectChanged=!1}this._interaction&&requestAnimationFrame(function(){return a._redraw()})}},{key:"destroy",value:function(){this._interaction=!1,this._rectChanged=!1,y(document,t.DOWN,this),y(document,t.MOVE,this),y(document,t.UP,this),zb(this._element)}},{key:"element",get:function(){return this._element}},{key:"space",get:function(){return this._space}},{key:"area",get:function(){var a=this._rect.x/this._space.width,b=this._rect.y/this._space.height,c=this._rect.width/this._space.width,d=this._rect.height/this._space.height;return{x:a,y:b,width:c,height:d}}},{key:"dirty",get:function(){return 0!==this._rect.x||0!==this._rect.y||0!==this._rect.width||0!==this._rect.height}},{key:"minWidth",set:function(a){this._minWidth=Math.max(a,1)}},{key:"minHeight",set:function(a){this._minHeight=Math.max(a,1)}},{key:"ratio",set:function(a){this._ratio=a}}]),d}()}(),Fb=function(){var c=["input","change"],d=function(){function d(){var c=arguments.length>0&&arguments[0]!==b?arguments[0]:document.createElement("div"),e=arguments.length>1&&arguments[1]!==b?arguments[1]:{};a(this,d),this._element=c,this._options=r(d.options(),e),this._ratio=null,this._output=null,this._rotating=!1,this._input=null,this._preview=null,this._previewBlurred=null,this._blurredPreview=!1,this._cropper=null,this._straightCrop=null,this._previewWrapper=null,this._currentWindowSize={},this._btnGroup=null,this._maskFrame=null,this._dirty=!1,this._wrapperRotation=0,this._wrapperScale=1,this._init()}return l(d,[{key:"_init",value:function(){var a=this;this._element.className="slim-image-editor",this._container=w("div","slim-container"),this._wrapper=w("div","slim-wrapper"),this._stage=w("div","slim-stage"),this._container.appendChild(this._stage),this._cropper=new Eb,c.forEach(function(b){a._cropper.element.addEventListener(b,a)}),this._stage.appendChild(this._cropper.element),this._previewWrapper=w("div","slim-image-editor-preview slim-crop-preview"),this._previewBlurred=w("canvas","slim-crop-blur"),this._previewWrapper.appendChild(this._previewBlurred),this._wrapper.appendChild(this._previewWrapper),this._previewMask=w("div","slim-crop-mask"),this._preview=w("img"),this._previewMask.appendChild(this._preview),this._cropper.element.appendChild(this._previewMask),this._btnGroup=w("div","slim-editor-btn-group"),d.Buttons.forEach(function(b){var c=D(b),d=a._options["button"+c+"Label"],e=a._options["button"+c+"Title"],f=a._options["button"+c+"ClassName"],g=w("button","slim-editor-btn slim-btn-"+b+(f?" "+f:""));g.innerHTML=d,g.title=e||d,g.type="button",g.setAttribute("data-action",b),g.addEventListener("click",a),a._btnGroup.appendChild(g)}),this._utilsGroup=w("div","slim-editor-utils-group");var b=w("button","slim-editor-utils-btn slim-btn-rotate"+(this._options.buttonRotateClassName?" "+this._options.buttonRotateClassName:""));b.setAttribute("data-action","rotate"),b.addEventListener("click",this),b.title=this._options.buttonRotateTitle,this._utilsGroup.appendChild(b),this._container.appendChild(this._wrapper),this._element.appendChild(this._container),this._element.appendChild(this._utilsGroup),this._element.appendChild(this._btnGroup)}},{key:"dirty",value:function(){this._dirty=!0}},{key:"handleEvent",value:function(a){switch(a.type){case"click":this._onClick(a);break;case"change":this._onGridChange(a);break;case"input":this._onGridInput(a);break;case"keydown":this._onKeyDown(a);break;case"resize":this._onResize(a)}}},{key:"_onKeyDown",value:function(a){switch(a.keyCode){case s.RETURN:this._confirm();break;case s.ESC:this._cancel()}}},{key:"_onClick",value:function(a){a.target.classList.contains("slim-btn-cancel")&&this._cancel(),a.target.classList.contains("slim-btn-confirm")&&this._confirm(),a.target.classList.contains("slim-btn-rotate")&&this._rotate()}},{key:"_onResize",value:function(){this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},this._redraw(),this._redrawCropper(this._cropper.area),this._updateWrapperScale(),this._redrawWrapper()}},{key:"_redrawWrapper",value:function(){var a=j.createMatrix();a.scale(this._wrapperScale,this._wrapperScale),a.rotateZ(this._wrapperRotation*(Math.PI/180)),j.setElementTransform(this._previewWrapper,a)}},{key:"_onGridInput",value:function(){this._redrawCropMask()}},{key:"_onGridChange",value:function(){this._redrawCropMask()}},{key:"_updateWrapperRotation",value:function(){this._wrapperRotation+=this._options.minSize.width>this._input.height||this._options.minSize.height>this._input.width?180:90}},{key:"_updateWrapperScale",value:function(){var a=this._wrapperRotation%180!==0;if(a){var b=this._container.offsetWidth,c=this._container.offsetHeight,d=this._wrapper.offsetHeight,e=this._wrapper.offsetWidth,f=b/d;f*e>c&&(f=c/e),this._wrapperScale=f}else this._wrapperScale=1}},{key:"_cancel",value:function(){this._rotating||this._element.dispatchEvent(new CustomEvent("cancel"))}},{key:"_confirm",value:function(){if(!this._rotating){var a=this._wrapperRotation%180!==0,b=this._cropper.area,c=nb(b,a?this._input.height:this._input.width,a?this._input.width:this._input.height);this._element.dispatchEvent(new CustomEvent("confirm",{detail:{rotation:this._wrapperRotation%360,crop:c}}))}}},{key:"_rotate",value:function(){var a=this;if(!this._rotating){this._rotating=!0,this._updateWrapperRotation();var b=1===this.ratio||null===this._ratio?this._cropper.area:null;b&&A(b,90),this._updateWrapperScale(),this._hideCropper(),j(this._previewWrapper,{rotation:[0,0,this._wrapperRotation*(Math.PI/180)],scale:[this._wrapperScale,this._wrapperScale],easing:"spring",springConstant:.8,springDeceleration:.65,complete:function(){a._redrawCropper(b),a._showCropper(),a._rotating=!1}})}}},{key:"_showCropper",value:function(){j(this._stage,{easing:"ease",duration:250,fromOpacity:0,opacity:1})}},{key:"_hideCropper",value:function(){j(this._stage,{duration:0,fromOpacity:0,opacity:0})}},{key:"_redrawCropMask",value:function(){var a=this,b=this._wrapperRotation%360,c=this._wrapperScale,d={width:this._wrapper.offsetWidth,height:this._wrapper.offsetHeight},e=this._cropper.area,f={x:0,y:0};0===b?(f.x=-e.x,f.y=-e.y):90===b?(f.x=-(1-e.y),f.y=-e.x):180===b?(f.x=-(1-e.x),f.y=-(1-e.y)):270===b&&(f.x=-e.y,f.y=-(1-e.x)),f.x*=d.width,f.y*=d.height,cancelAnimationFrame(this._maskFrame),this._maskFrame=requestAnimationFrame(function(){var d="scale("+c+") rotate("+-b+"deg) translate("+f.x+"px, "+f.y+"px);";a._preview.style.cssText="\n					width: "+a._previewSize.width+"px;\n					height: "+a._previewSize.height+"px;\n					-webkit-transform: "+d+";\n					transform: "+d+";\n				"})}},{key:"open",value:function(a,b,c,d,e){var f=this;if(this._input&&!this._dirty&&this._ratio===b)return void e();this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},this._dirty=!1,this._wrapperRotation=d||0,this._blurredPreview=!1,this._ratio=b,this._previewSize=null,this._element.style.opacity="0",this._input=a;var g=d%180!==0,h=ob(c,g?a.height:a.width,g?a.width:a.height);this._preview.onload=function(){f._preview.onload=null,f._cropper.ratio=f.ratio,f._redraw(),f._redrawCropper(h),e(),f._element.style.opacity=""},this._preview.src="",this._preview.src=ib(this._input,Math.min(this._container.offsetWidth/this._input.width,this._container.offsetHeight/this._input.height)*this._options.devicePixelRatio).toDataURL()}},{key:"_redrawCropper",value:function(a){var b=this._wrapperRotation%180!==0,c=b?this._input.height/this._input.width:this._input.width/this._input.height,d=this._wrapper.offsetWidth,e=this._wrapper.offsetHeight,f=this._container.offsetWidth,g=this._container.offsetHeight;this._updateWrapperScale();var h=this._wrapperScale*(b?e:d),i=this._wrapperScale*(b?d:e),j=b?.5*(f-h):this._wrapper.offsetLeft,k=b?.5*(g-i):this._wrapper.offsetTop;this._stage.style.cssText="\n				left:"+j+"px;\n				top:"+k+"px;\n				width:"+h+"px;\n				height:"+i+"px;\n			",this._cropper.limit(h,h/c),this._cropper.offset(j+this._element.offsetLeft,k+this._element.offsetTop),this._cropper.minWidth=this._wrapperScale*this._options.minSize.width*this.scalar,this._cropper.minHeight=this._wrapperScale*this._options.minSize.height*this.scalar;var l=null;l=a?{x:a.x*h,y:a.y*i,width:a.width*h,height:a.height*i}:ab(h,i,this._ratio||i/h),this._cropper.resize(l.x,l.y,l.width,l.height)}},{key:"_redraw",value:function(){var a=this._input.height/this._input.width,b=this._container.clientWidth,c=this._container.clientHeight,d=b,e=d*a;e>c&&(e=c,d=e/a),d=Math.round(d),e=Math.round(e);var f=(b-d)/2,g=(c-e)/2;this._wrapper.style.cssText="\n				left:"+f+"px;\n				top:"+g+"px;\n				width:"+d+"px;\n				height:"+e+"px;\n			",this._previewBlurred.style.cssText="\n				width:"+d+"px;\n				height:"+e+"px;\n			",this._preview.style.cssText="\n				width:"+d+"px;\n				height:"+e+"px;\n			",this._previewSize={width:d,height:e},this._blurredPreview||(this._previewBlurred.width=300,this._previewBlurred.height=this._previewBlurred.width*a,kb(this._input,this._previewBlurred),lb(this._previewBlurred,3),this._blurredPreview=!0)}},{key:"show",value:function(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};(this._currentWindowSize.width!==window.innerWidth||this._currentWindowSize.height!==window.innerHeight)&&(this._redraw(),this._redrawCropper(this._cropper.area)),document.addEventListener("keydown",this),window.addEventListener("resize",this);var c=this._wrapperRotation*(Math.PI/180);j(this._previewWrapper,{fromRotation:[0,0,c],rotation:[0,0,c],fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,fromScale:[this._wrapperScale-.02,this._wrapperScale-.02],scale:[this._wrapperScale,this._wrapperScale],easing:"spring",springConstant:.3,springDeceleration:.85,delay:450,complete:function(){}}),this._cropper.dirty?j(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:850,complete:function(){I(this),a()}}):j(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:1e3,complete:function(){I(this)}}),j(this._btnGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,delay:function(a){return 1e3+100*a},easing:"spring",springConstant:.3,springDeceleration:.85,complete:function(){I(this)}}),j(this._utilsGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.85,delay:1250,complete:function(){I(this)}})}},{key:"hide",value:function(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};document.removeEventListener("keydown",this),window.removeEventListener("resize",this),j(this._utilsGroup.childNodes,{fromOpacity:1,opacity:0,duration:250}),j(this._btnGroup.childNodes,{fromOpacity:1,opacity:0,delay:200,duration:350}),j([this._stage,this._previewWrapper],{fromPosition:[0,0,0],position:[0,-250,0],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,delay:250,allDone:function(){a()}})}},{key:"destroy",value:function(){var a=this;yb(this._btnGroup.children).forEach(function(b){b.removeEventListener("click",a)}),c.forEach(function(b){a._cropper.element.removeEventListener(b,a)}),this._cropper.destroy(),this._element.parentNode&&zb(this._element)}},{key:"showRotateButton",set:function(a){a?this._element.classList.remove("slim-rotation-disabled"):this._element.classList.add("slim-rotation-disabled")}},{key:"element",get:function(){return this._element}},{key:"ratio",get:function(){return"input"===this._ratio?this._input.height/this._input.width:this._ratio}},{key:"offset",get:function(){return this._element.getBoundingClientRect()}},{key:"original",get:function(){return this._input}},{key:"scalar",get:function(){return this._previewSize.width/this._input.width}}],[{key:"options",value:function(){return{buttonCancelClassName:null,buttonConfirmClassName:null,buttonCancelLabel:"Cancel",buttonConfirmLabel:"Confirm",buttonCancelTitle:null,buttonConfirmTitle:null,buttonRotateTitle:"Rotate",buttonRotateClassName:null,devicePixelRatio:null,minSize:{width:0,height:0}}}}]),d}();return d.Buttons=["cancel","confirm"],d}(Eb),Gb=function(){var c=["dragenter","dragover","dragleave","drop"];return function(){function d(){var c=arguments.length>0&&arguments[0]!==b?arguments[0]:document.createElement("div");a(this,d),this._element=c,this._accept=[],this._allowURLs=!1,this._dragPath=null,this._init()}return l(d,[{key:"isValidDataTransfer",value:function(a){return a.files&&a.files.length?this.areValidDataTransferFiles(a.files):a.items&&a.items.length?this.areValidDataTransferItems(a.items):null}},{key:"areValidDataTransferFiles",value:function(a){return this._accept.length&&a?-1!==this._accept.indexOf(a[0].type):!0}},{key:"areValidDataTransferItems",value:function(a){return this._accept.length&&a?this._allowURLs&&"string"===a[0].kind?null:a[0].type&&0===a[0].type.indexOf("application")?null:-1!==this._accept.indexOf(a[0].type):!0}},{key:"reset",value:function(){this._element.files=null}},{key:"_init",value:function(){var a=this;this._element.className="slim-file-hopper",c.forEach(function(b){a._element.addEventListener(b,a)})}},{key:"handleEvent",value:function(a){switch(a.type){case"dragenter":case"dragover":this._onDragOver(a);break;case"dragleave":this._onDragLeave(a);break;case"drop":this._onDrop(a)}}},{key:"_onDrop",value:function(a){a.preventDefault();var b=null;if(this._allowURLs){var c=void 0,d=void 0;try{c=a.dataTransfer.getData("url"),d=a.dataTransfer.getData("text/html")}catch(a){}if(d&&d.length){var e=d.match(/src\s*=\s*"(.+?)"/);e&&(b=e[1])}else c&&c.length&&(b=c)}if(b)this._element.files=[{remote:b}];else{var f=this.isValidDataTransfer(a.dataTransfer);if(!f)return this._element.dispatchEvent(new CustomEvent("file-invalid-drop")),void(this._dragPath=null);this._element.files=a.dataTransfer.files}this._element.dispatchEvent(new CustomEvent("file-drop",{detail:q(a)})),this._element.dispatchEvent(new CustomEvent("change")),this._dragPath=null}},{key:"_onDragOver",value:function(a){a.preventDefault(),a.dataTransfer.dropEffect="copy";var b=this.isValidDataTransfer(a.dataTransfer);return null===b||b?(this._dragPath||(this._dragPath=[]),this._dragPath.push(q(a)),void this._element.dispatchEvent(new CustomEvent("file-over",{detail:{x:E(this._dragPath).x,y:E(this._dragPath).y}}))):(a.dataTransfer.dropEffect="none",void this._element.dispatchEvent(new CustomEvent("file-invalid")))}},{key:"_onDragLeave",value:function(a){this._element.dispatchEvent(new CustomEvent("file-out",{detail:q(a)})),this._dragPath=null}},{key:"destroy",value:function(){var a=this;c.forEach(function(b){a._element.removeEventListener(b,a)}),zb(this._element),this._element=null,this._dragPath=null,this._accept=null}},{key:"element",get:function(){return this._element}},{key:"dragPath",get:function(){return this._dragPath}},{key:"enabled",get:function(){return""===this._element.style.display},set:function(a){this._element.style.display=a?"":"none"}},{key:"allowURLs",set:function(a){this._allowURLs=a}},{key:"accept",set:function(a){this._accept=a},get:function(){return this._accept}}]),d}()}(),Hb=function(){return function(){function c(){a(this,c),this._element=null,this._inner=null,this._init()}return l(c,[{key:"_init",value:function(){this._element=w("div","slim-popover"),this._element.setAttribute("data-state","off"),document.body.appendChild(this._element),this._element.addEventListener("touchmove",function(a){a.preventDefault()},!0)}},{key:"show",value:function(){var a=this,c=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};this._element.setAttribute("data-state","on"),j(this._element,{fromOpacity:0,opacity:1,duration:350,complete:function(){I(a._element),c()}})}},{key:"hide",value:function(){var a=this,c=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){};j(this._element,{fromOpacity:1,opacity:0,duration:500,complete:function(){I(a._element),a._element.setAttribute("data-state","off"),c()}})}},{key:"destroy",value:function(){this._element.parentNode&&(this._element.parentNode.removeChild(this._element),this._element=null,this._inner=null)}},{key:"inner",set:function(a){this._inner=a,this._element.firstChild&&this._element.removeChild(this._element.firstChild),this._element.appendChild(this._inner)}},{key:"className",set:function(a){this._element.className="slim-popover"+(null===a?"":" "+a)}}]),c}()}(),Ib=function(a,b){return a.split(b).map(function(a){return parseInt(a,10)})},Jb=function(a){return"DIV"===a.nodeName||"SPAN"===a.nodeName},Kb={AUTO:"auto",INITIAL:"initial",MANUAL:"manual"},Lb=["x","y","width","height"],Mb=["file-invalid-drop","file-invalid","file-drop","file-over","file-out","click"],Nb=["cancel","confirm"],Ob=["remove","edit","download","upload"],Pb=null,Qb=0,Rb='\n<div class="slim-loader">\n	<svg>\n		<path class="slim-loader-background" fill="none" stroke-width="3" />\n		<path class="slim-loader-foreground" fill="none" stroke-width="3" />\n	</svg>\n</div>\n',Sb='\n<div class="slim-upload-status"></div>\n',Tb=function(a){var b=a.split(",");return{width:parseInt(b[0],10),height:parseInt(b[1],10)}},Ub=function(){function c(d){var e=arguments.length>1&&arguments[1]!==b?arguments[1]:{};a(this,c),Pb||(Pb=new Hb),this._uid=Qb++,this._options=r(c.options(),e),this._options.forceSize&&("string"==typeof this._options.forceSize&&(this._options.forceSize=Tb(this._options.forceSize)),this._options.ratio=this._options.forceSize.width+":"+this._options.forceSize.height,this._options.size=qb(this._options.forceSize)),"string"==typeof this._options.size&&(this._options.size=Tb(this._options.size)),"string"==typeof this._options.minSize&&(this._options.minSize=Tb(this._options.minSize)),this._originalElement=d,this._originalElementInner=d.innerHTML,this._originalElementAttributes=p(d),Jb(d)?this._element=d:(this._element=Ab(d),this._element.className=d.className,d.className="",this._element.setAttribute("data-ratio",this._options.ratio)),this._element.classList.add("slim"),this._element.setAttribute("data-state","init"),this._state=[],this._timers=[],this._input=null,this._inputReference=null,this._output=null,this._ratio=null,this._isRequired=!1,this._imageHopper=null,this._imageEditor=null,this._progressEnabled=!0,this._data={},this._resetData(),this._drip=null,this._hasInitialImage=!1,this._initialCrop=this._options.crop,this._initialRotation=this._options.rotation&&this._options.rotation%90===0?this._options.rotation:null,this._isBeingDestroyed=!1,c.supported?this._init():this._fallback()}return l(c,[{key:"setRotation",value:function(a,b){if("number"==typeof a||a%90===0){this._data.actions.rotation=a;var c=this._data.actions.rotation%180!==0;if(this._data.input.image){var d=c?this._data.input.image.height:this._data.input.image.width,e=c?this._data.input.image.width:this._data.input.image.height;this._data.actions.crop=ab(d,e,this._ratio),this._data.actions.crop.type=Kb.AUTO}this._data.input.image&&b&&this._manualTransform(b)}}},{key:"setSize",value:function(a,b){"string"==typeof a&&(a=Tb(a)),a&&a.width&&a.height&&(this._options.size=qb(a),this._data.actions.size=qb(a),this._data.input.image&&b&&this._manualTransform(b))}},{key:"setForceSize",value:function(a,b){"string"==typeof a&&(a=Tb(a)),a&&a.width&&a.height&&(this._options.size=qb(a),this._options.forceSize=qb(a),this._data.actions.size=qb(a),this.setRatio(this._options.forceSize.width+":"+this._options.forceSize.height,b))}},{key:"setRatio",value:function(a,b){var c=this;if(a&&"string"==typeof a&&(this._options.ratio=a,this._isFixedRatio())){var d=Ib(this._options.ratio,":");this._ratio=d[1]/d[0],this._data.input.image&&b?this._cropAuto(function(a){c._scaleDropArea(c._ratio),b&&b(a)}):(this._data.input.image&&(this._data.actions.crop=ab(this._data.input.image.width,this._data.input.image.height,this._ratio),this._data.actions.crop.type=Kb.AUTO),this._scaleDropArea(this._ratio),b&&b(null))
}}},{key:"isAttachedTo",value:function(a){return this._element===a||this._originalElement===a}},{key:"isDetached",value:function(){return null===this._element.parentNode}},{key:"load",value:function(a){var c=arguments.length>1&&arguments[1]!==b?arguments[1]:{},d=arguments[2];"function"==typeof c?d=c:(this._options.crop=c.crop,this._options.rotation=c.rotation,this._initialRotation=c.rotation&&c.rotation%90===0?c.rotation:null,this._initialCrop=this._options.crop),this._load(a,d,{blockPush:c.blockPush})}},{key:"upload",value:function(a){this._doUpload(a)}},{key:"download",value:function(){this._doDownload()}},{key:"remove",value:function(){return this._doRemove()}},{key:"destroy",value:function(){this._doDestroy()}},{key:"edit",value:function(){this._doEdit()}},{key:"crop",value:function(a,b){this._crop(a.x,a.y,a.width,a.height,b)}},{key:"containsImage",value:function(){return null!==this._data.input.name}},{key:"_canInstantEdit",value:function(){return this._options.instantEdit&&!this._isInitialising}},{key:"_getFileInput",value:function(){return this._element.querySelector("input[type=file]")}},{key:"_getInitialImage",value:function(){return this._element.querySelector("img")}},{key:"_getInputElement",value:function(){return this._getFileInput()||this._getInitialImage()}},{key:"_getRatioSpacerElement",value:function(){return this._element.children[0]}},{key:"_isImageOnly",value:function(){return"INPUT"!==this._input.nodeName}},{key:"_isFixedRatio",value:function(){return-1!==this._options.ratio.indexOf(":")}},{key:"_isAutoCrop",value:function(){return this._data.actions.crop.type===Kb.AUTO}},{key:"_toggleButton",value:function(a,b){xb('.slim-btn[data-action="'+a+'"]',b,this._element)}},{key:"_clearState",value:function(){this._state=[],this._updateState()}},{key:"_removeState",value:function(a){this._state=this._state.filter(function(b){return b!==a}),this._updateState()}},{key:"_addState",value:function(a){G(a,this._state)||(this._state.push(a),this._updateState())}},{key:"_updateState",value:function(){this._element&&this._element.setAttribute("data-state",this._state.join(","))}},{key:"_resetData",value:function(){this._data={server:null,meta:qb(this._options.meta),input:{field:this._inputReference,name:null,type:null,width:0,height:0,file:null},output:{image:null,width:0,height:0},actions:{rotation:null,crop:null,size:null}},this._output&&(this._output.value=""),pb(this._getFileInput())}},{key:"_init",value:function(){var a=this;if(this._isInitialising=!0,this._addState("empty"),G("input",this._options.post)&&(this._inputReference="slim_input_"+this._uid),this._input=this._getInputElement(),this._input||(this._input=w("input"),this._input.type="file",this._element.appendChild(this._input)),this._isRequired=this._input.required===!0,this._output=this._element.querySelector("input[type=hidden]"),this._output){var b=null;try{b=JSON.parse(this._output.value)}catch(c){}if(b){var d=new Image;d.src=b.output.image,d.setAttribute("data-filename",b.output.name),this._element.insertBefore(d,this._element.firstChild)}}else this._output=w("input"),this._output.type="hidden",this._output.name=this._input.name||this._options.defaultInputName,this._element.appendChild(this._output);this._input.removeAttribute("name");var e=w("div","slim-area"),f=this._getInitialImage(),g=(f||{}).src,h=f?f.getAttribute("data-filename"):null;g?this._hasInitialImage=!0:(this._initialCrop=null,this._initialRotation=null);var i='\n		<div class="slim-result">\n			<img class="in" style="opacity:0" '+(g?'src="'+g+'"':"")+'><img><img style="opacity:0">\n		</div>';if(this._isImageOnly())e.innerHTML="\n				"+Rb+"\n				"+Sb+"\n				"+i+'\n				<div class="slim-status"><div class="slim-label-loading">'+(this._options.labelLoading||"")+"</div></div>\n			";else{G("input",this._options.post)&&(this._data.input.field=this._inputReference,this._options.service||(this._input.name=this._inputReference));var j=void 0;this._input.hasAttribute("accept")&&"image/*"!==this._input.getAttribute("accept")?j=this._input.accept.split(",").map(function(a){return a.trim()}).filter(function(a){return a.length>0}):(j=K(),this._input.setAttribute("accept",j.join(","))),this._imageHopper=new Gb,this._imageHopper.accept=j,this._imageHopper.allowURLs="string"==typeof this._options.fetcher,this._element.appendChild(this._imageHopper.element),Mb.forEach(function(b){a._imageHopper.element.addEventListener(b,a)}),e.innerHTML="\n				"+Rb+"\n				"+Sb+'\n				<div class="slim-drip"><span><span></span></span></div>\n				<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+'</div><div class="slim-label-loading">'+(this._options.labelLoading||"")+"</div></div>\n				"+i+"\n			",this._input.addEventListener("change",this)}if(this._element.appendChild(e),this._btnGroup=w("div","slim-btn-group"),this._btnGroup.style.display="none",this._element.appendChild(this._btnGroup),Ob.filter(function(b){return a._isButtonAllowed(b)}).forEach(function(b){var c=D(b),d=a._options["button"+c+"Label"],e=a._options["button"+c+"Title"]||d,f=a._options["button"+c+"ClassName"],g=w("button","slim-btn slim-btn-"+b+(f?" "+f:""));g.innerHTML=d,g.title=e,g.type="button",g.addEventListener("click",a),g.setAttribute("data-action",b),a._btnGroup.appendChild(g)}),this._isFixedRatio()){var k=Ib(this._options.ratio,":");this._ratio=k[1]/k[0],this._scaleDropArea(this._ratio)}this._updateProgress(.5),g?this._load(g,function(){a._onInit()},{name:h}):this._onInit()}},{key:"_onInit",value:function(){var a=this;this._isInitialising=!1;var b=function(){var b=setTimeout(function(){a._options.didInit.apply(a,[a.data,a])},0);a._timers.push(b)};this._options.saveInitialImage&&this.containsImage()?this._options.service||this._save(function(){b()},!1):(this._options.service&&this.containsImage()&&this._toggleButton("upload",!1),b())}},{key:"_updateProgress",value:function(a){if(a=Math.min(.99999,a),this._element&&this._progressEnabled){var b=this._element.querySelector(".slim-loader");if(b){var c=b.offsetWidth,d=b.querySelectorAll("path"),e=parseInt(d[0].getAttribute("stroke-width"),10);d[0].setAttribute("d",Db(.5*c,.5*c,.5*c-e,.9999)),d[1].setAttribute("d",Db(.5*c,.5*c,.5*c-e,a))}}}},{key:"_startProgress",value:function(a){var b=this;if(this._element){this._progressEnabled=!1;var c=this._element.querySelector(".slim-loader");if(c){var d=c.children[0];this._stopProgressLoop(function(){c.removeAttribute("style"),d.removeAttribute("style"),b._progressEnabled=!0,b._updateProgress(0),b._progressEnabled=!1,j(d,{fromOpacity:0,opacity:1,duration:250,complete:function(){b._progressEnabled=!0,a&&a()}})})}}}},{key:"_stopProgress",value:function(){var a=this;if(this._element){var b=this._element.querySelector(".slim-loader");if(b){var c=b.children[0];this._updateProgress(1),j(c,{fromOpacity:1,opacity:0,duration:250,complete:function(){b.removeAttribute("style"),c.removeAttribute("style"),a._updateProgress(.5),a._progressEnabled=!1}})}}}},{key:"_startProgressLoop",value:function(){if(this._element){var a=this._element.querySelector(".slim-loader");if(a){var b=a.children[0];a.removeAttribute("style"),b.removeAttribute("style"),this._updateProgress(.5);var c=1e3;j(a,"stop"),j(a,{rotation:[0,0,-(2*Math.PI)*c],easing:"linear",duration:1e3*c}),j(b,{fromOpacity:0,opacity:1,duration:250})}}}},{key:"_stopProgressLoop",value:function(a){if(this._element){var b=this._element.querySelector(".slim-loader");if(b){var c=b.children[0];j(c,{fromOpacity:parseFloat(c.style.opacity),opacity:0,duration:250,complete:function(){j(b,"stop"),b.removeAttribute("style"),c.removeAttribute("style"),a&&a()}})}}}},{key:"_isButtonAllowed",value:function(a){return"edit"===a?this._options.edit:"download"===a?this._options.download:"upload"===a?this._options.service?this._options.push?!1:!0:!1:"remove"===a?!this._isImageOnly():!0}},{key:"_fallback",value:function(){var a=w("div","slim-area");a.innerHTML='\n			<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+"</div></div>\n		",this._element.appendChild(a),this._throwError(this._options.statusNoSupport)}},{key:"handleEvent",value:function(a){switch(a.type){case"click":this._onClick(a);break;case"change":this._onChange(a);break;case"cancel":this._onCancel(a);break;case"confirm":this._onConfirm(a);break;case"file-over":this._onFileOver(a);break;case"file-out":this._onFileOut(a);break;case"file-drop":this._onDropFile(a);break;case"file-invalid":this._onInvalidFile(a);break;case"file-invalid-drop":this._onInvalidFileDrop(a)}}},{key:"_getIntro",value:function(){return this._element.querySelector(".slim-result .in")}},{key:"_getOutro",value:function(){return this._element.querySelector(".slim-result .out")}},{key:"_getInOut",value:function(){return this._element.querySelectorAll(".slim-result img")}},{key:"_getDrip",value:function(){return this._drip||(this._drip=this._element.querySelector(".slim-drip > span")),this._drip}},{key:"_throwError",value:function(a){this._addState("error"),this._element.querySelector(".slim-label").style.display="none";var b=this._element.querySelector(".slim-error");b||(b=w("div","slim-error"),this._element.querySelector(".slim-status").appendChild(b)),b.innerHTML=a,this._options.didThrowError.apply(this,[a])}},{key:"_removeError",value:function(){this._removeState("error"),this._element.querySelector(".slim-label").style.display="";var a=this._element.querySelector(".slim-error");a&&a.parentNode.removeChild(a)}},{key:"_openFileDialog",value:function(){this._removeError(),this._input.click()}},{key:"_onClick",value:function(a){var b=this,c=a.target.classList,d=a.target;if(c.contains("slim-file-hopper"))return a.preventDefault(),void this._openFileDialog();switch(d.getAttribute("data-action")){case"remove":this._options.willRemove.apply(this,[this.data,function(){b._doRemove()}]);break;case"edit":this._doEdit();break;case"download":this._doDownload();break;case"upload":this._doUpload()}}},{key:"_onInvalidFileDrop",value:function(){this._onInvalidFile(),this._removeState("file-over");var a=this._getDrip();j(a.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){I(a.firstChild)}})}},{key:"_onInvalidFile",value:function(){var a=this._imageHopper.accept.map(M),b=this._options.statusFileType.replace("$0",a.join(", "));this._throwError(b)}},{key:"_onImageTooSmall",value:function(){var a=this._options.statusImageTooSmall.replace("$0",this._options.minSize.width+"  "+this._options.minSize.height);this._throwError(a)}},{key:"_onOverWeightFile",value:function(){var a=this._options.statusFileSize.replace("$0",this._options.maxFileSize);this._throwError(a)}},{key:"_onLocalURLProblem",value:function(a){this._throwError(this._options.statusLocalUrlProblem||a)}},{key:"_onRemoteURLProblem",value:function(a){this._throwError(a)}},{key:"_onFileOver",value:function(a){this._addState("file-over"),this._removeError();var b=this._getDrip(),c=j.createMatrix();c.translate(a.detail.x,a.detail.y,0),j.setElementTransform(b,c),1==this._imageHopper.dragPath.length&&(b.style.opacity=1,j(b.firstChild,{fromOpacity:0,opacity:.5,fromScale:[0,0],scale:[.5,.5],duration:150}))}},{key:"_onFileOut",value:function(a){this._removeState("file-over"),this._removeState("file-invalid"),this._removeError();var b=this._getDrip(),c=j.createMatrix();c.translate(a.detail.x,a.detail.y,0),j.setElementTransform(b,c),j(b.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){I(b.firstChild)}})}},{key:"_onDropFile",value:function(a){var b=this;this._removeState("file-over");var c=this._getDrip(),d=j.createMatrix();d.translate(a.detail.x,a.detail.y,0),j.setElementTransform(c,d);var e=this._imageHopper.dragPath.length,f=this._imageHopper.dragPath[e-Math.min(10,e)],g=a.detail.x-f.x,h=a.detail.y-f.y;j(c,{fromPosition:[a.detail.x,a.detail.y,0],position:[a.detail.x+g,a.detail.y+h,0],duration:200}),j(c.firstChild,{fromScale:[.5,.5],scale:[2,2],fromOpacity:1,opacity:0,duration:200,complete:function(){I(c.firstChild),b._load(a.target.files[0])}})}},{key:"_onChange",value:function(a){a.target.files.length&&this._load(a.target.files[0])}},{key:"_load",value:function(a,c){var d=this,e=arguments.length>2&&arguments[2]!==b?arguments[2]:{};if(!this._isBeingDestroyed){if(this.containsImage())return clearTimeout(this._replaceTimeout),void this._doRemove(function(){d._replaceTimeout=setTimeout(function(){d._load(a,c,e)},100)});this._removeState("empty"),this._addState("busy"),this._startProgressLoop(),this._imageHopper&&(this._imageHopper.enabled=!1),clearTimeout(this._loadTimeout);var f=function(){clearTimeout(d._loadTimeout),d._loadTimeout=setTimeout(function(){d._isBeingDestroyed||(d._addState("loading"),j(d._element.querySelector(".slim-label-loading"),{fromOpacity:0,opacity:1,duration:250}))},500)},g=function(){d._imageHopper&&(d._imageHopper.enabled=!0),d._removeState("loading"),d._removeState("busy"),d._addState("empty"),d._stopProgressLoop()};if("string"==typeof a)return void(V(a)?this._load(Z(a),c,e):(f(),X(a,this._options.willLoad,function(a){d._load(a,c,e)},function(a){setTimeout(function(){g(),d._onLocalURLProblem("<p>"+a+"</p>"),c&&c.apply(d,["local-url-problem"])},500)})));if("undefined"!=typeof a.remote)return V(a.remote)?void this._load(Z(a.remote),c,e):void(this._options.fetcher&&W(this._options.fetcher,this._options.willFetch,this._options.willLoad,a.remote,function(a){g(),d._onRemoteURLProblem("<p>"+a+"</p>"),c&&c.apply(d,["remote-url-problem"])},function(a){d._load(a,c,e)}));var h=a;if(this._imageHopper&&-1===this._imageHopper.accept.indexOf(h.type))return g(),this._onInvalidFile(),void(c&&c.apply(this,["file-invalid"]));if(h.size&&this._options.maxFileSize&&J(h.size)>this._options.maxFileSize)return g(),this._onOverWeightFile(),void(c&&c.apply(this,["file-too-big"]));this._imageEditor&&this._imageEditor.dirty(),this._data.input.name=e&&e.name?e.name:R(h),this._data.input.type=S(h),this._data.input.size=h.size,this._data.input.file=h,_(h,this._options.internalCanvasSize,function(a,b){var f=function(){d._imageHopper&&(d._imageHopper.enabled=!0),d._removeState("loading"),d._removeState("busy"),d._addState("empty"),d._stopProgressLoop(),d._resetData()};if(!a)return f(),void(c&&c.apply(d,["file-not-found"]));if(!mb(a,d._options.minSize))return f(),d._onImageTooSmall(),void(c&&c.apply(d,["image-too-small"]));var g=d._options.didLoad.apply(d,[h,a,b,d]);if(g!==!0)return f(),g!==!1&&d._throwError(g),void(c&&c.apply(d,[g]));d._removeState("loading");var i=function(a){d._imageHopper&&d._options.dropReplace&&(d._imageHopper.enabled=!0);var b=d._getIntro(),c={fromScale:[1.25,1.25],scale:[1,1],fromOpacity:0,opacity:1,complete:function(){I(b),b.style.opacity=1,a()}};d.isDetached()?c.duration=1:(c.easing="spring",c.springConstant=.3,c.springDeceleration=.7),d._canInstantEdit()&&(c.delay=500,c.duration=1,d._doEdit()),j(b,c)};d._loadCanvas(a,function(a){d._addState("preview"),i(function(){d._canInstantEdit()||a||d._showButtons(),a||(d._stopProgressLoop(),d._removeState("busy")),c&&c.apply(d,[null,d.data])})},function(){d._canInstantEdit()||d._showButtons(),d._removeState("busy")},{blockPush:e.blockPush})})}}},{key:"_loadCanvas",value:function(a,b,c,d){var e=this;if(d||(d={}),!this._isBeingDestroyed){this._data.input.image=a,this._data.input.width=a.width,this._data.input.height=a.height,this._initialRotation&&(this._data.actions.rotation=this._initialRotation,this._initialRotation=null);var f=this._data.actions.rotation%180!==0;this._isFixedRatio()||(this._ratio=this._initialCrop?this._initialCrop.height/this._initialCrop.width:f?a.width/a.height:a.height/a.width,this._scaleDropArea(this._ratio)),this._initialCrop?(this._data.actions.crop=qb(this._initialCrop),this._data.actions.crop.type=Kb.INITIAL,this._initialCrop=null):(this._data.actions.crop=ab(f?a.height:a.width,f?a.width:a.height,this._ratio),this._data.actions.crop.type=Kb.AUTO),this._options.size&&(this._data.actions.size={width:this._options.size.width,height:this._options.size.height}),this._applyTransforms(a,function(a){var f=e._getIntro(),g=f.offsetWidth/a.width,h=!1;e._options.service&&e._options.push&&!d.blockPush&&(e._hasInitialImage||e._canInstantEdit()||(h=!0,e._stopProgressLoop(function(){e._startProgress(function(){e._updateProgress(.1)})}))),e._canInstantEdit()||e._save(function(){e._isBeingDestroyed||h&&(e._stopProgress(),c())},h);var i="auto"===e._options.devicePixelRatio?window.devicePixelRatio:e._options.devicePixelRatio;f.src="",f.src=ib(a,g*i).toDataURL(),f.onload=function(){f.onload=null,e._isBeingDestroyed||b&&b(h)}})}}},{key:"_applyTransforms",value:function(a,b){var c=this,d=qb(this._data.actions);d.filters={sharpen:this._options.filterSharpen/100},d.minSize=this._options.forceMinSize?this._options.minSize:{width:0,height:0},bb(a,d,function(a){var d=a;if(c._options.forceSize||c._options.size&&1==gb(c._options.size,a)){d=w("canvas"),d.width=c._options.size.width,d.height=c._options.size.height;var e=d.getContext("2d");e.drawImage(a,0,0,c._options.size.width,c._options.size.height)}if(c._options.forceMinSize&&c._options.size&&c._options.minSize.width===c._options.size.width&&c._options.minSize.height===c._options.size.height&&(d.width<c._options.minSize.width||d.height<c._options.minSize.height)){var f=Math.max(d.width,c._options.minSize.width),g=Math.max(d.height,c._options.minSize.height);d=w("canvas"),d.width=f,d.height=g;var h=d.getContext("2d");h.drawImage(a,0,0,f,g)}if(c._options.forceMinSize&&1===c._ratio&&(d.width<c._options.minSize.width||d.height<c._options.minSize.height)){d=w("canvas"),d.width=c._options.minSize.width,d.height=c._options.minSize.height;var i=d.getContext("2d");i.drawImage(a,0,0,d.width,d.height)}c._data.output.width=d.width,c._data.output.height=d.height,c._data.output.image=d,c._onTransformCanvas(function(a){c._data=a,c._options.didTransform.apply(c,[c.data,c]),b(c._data.output.image)})})}},{key:"_onTransformCanvas",value:function(a){this._options.willTransform.apply(this,[this.data,a,this])}},{key:"_appendEditor",value:function(){var a=this;this._imageEditor||(this._imageEditor=new Fb(w("div"),{minSize:this._options.minSize,devicePixelRatio:this._options.devicePixelRatio,buttonConfirmClassName:this._options.buttonConfirmClassName,buttonCancelClassName:this._options.buttonCancelClassName,buttonRotateClassName:this._options.buttonRotateClassName,buttonConfirmLabel:this._options.buttonConfirmLabel,buttonCancelLabel:this._options.buttonCancelLabel,buttonRotateLabel:this._options.buttonRotateLabel,buttonConfirmTitle:this._options.buttonConfirmTitle,buttonCancelTitle:this._options.buttonCancelTitle,buttonRotateTitle:this._options.buttonRotateTitle}),Nb.forEach(function(b){a._imageEditor.element.addEventListener(b,a)}))}},{key:"_scaleDropArea",value:function(a){var b=this._getRatioSpacerElement();b&&this._element&&(b.style.marginBottom=100*a+"%",this._element.setAttribute("data-ratio","1:"+a))}},{key:"_onCancel",value:function(){this._removeState("editor"),this._options.didCancel.apply(this,[this]),this._showButtons(),this._hideEditor(),this._options.instantEdit&&!this._hasInitialImage&&this._isAutoCrop()&&this._doRemove()}},{key:"_onConfirm",value:function(a){var b=this,c=this._options.service&&this._options.push;c?this._startProgress(function(){b._updateProgress(.1)}):this._startProgressLoop(),this._removeState("editor"),this._addState("busy"),this._output.value="",this._data.actions.rotation=a.detail.rotation,this._data.actions.crop=a.detail.crop,this._data.actions.crop.type=Kb.MANUAL,this._applyTransforms(this._data.input.image,function(a){b._options.didConfirm.apply(b,[b.data,b]);var d=b._getInOut(),e="out"===d[0].className?d[0]:d[1],f=e===d[0]?d[1]:d[0];e.className="in",e.style.opacity="0",e.style.zIndex="2",f.className="out",f.style.zIndex="1";var g="auto"===b._options.devicePixelRatio?window.devicePixelRatio:b._options.devicePixelRatio;e.src="",e.src=ib(a,e.offsetWidth/a.width*g).toDataURL(),e.onload=function(){e.onload=null,"free"===b._options.ratio&&(b._ratio=e.naturalHeight/e.naturalWidth,b._scaleDropArea(b._ratio)),b._hideEditor();var a=setTimeout(function(){b._showPreview(e,function(){b._save(function(){b._toggleButton("upload",!0),c?b._stopProgress():b._stopProgressLoop(),b._removeState("busy"),b._showButtons()},c)})},250);b._timers.push(a)}})}},{key:"_cropAuto",value:function(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){},c=this._data.actions.rotation%180!==0,d=ab(c?this._data.input.image.height:this._data.input.image.width,c?this._data.input.image.width:this._data.input.image.height,this._ratio);this._crop(d.x,d.y,d.width,d.height,a,Kb.AUTO)}},{key:"_crop",value:function(a,c,d,e){var f=arguments.length>4&&arguments[4]!==b?arguments[4]:function(){},g=arguments.length>5&&arguments[5]!==b?arguments[5]:Kb.MANUAL;this._output.value="",this._data.actions.crop={x:a,y:c,width:d,height:e},this._data.actions.crop.type=g,this._manualTransform(f)}},{key:"_manualTransform",value:function(a){var b=this;this._startProgressLoop(),this._addState("busy"),this._applyTransforms(this._data.input.image,function(c){var d=b._getInOut(),e="out"===d[0].className?d[0]:d[1],f=e===d[0]?d[1]:d[0];e.className="in",e.style.opacity="1",e.style.zIndex="2",f.className="out",f.style.zIndex="0";var g="auto"===b._options.devicePixelRatio?window.devicePixelRatio:b._options.devicePixelRatio;e.src="",e.src=ib(c,e.offsetWidth/c.width*g).toDataURL(),e.onload=function(){e.onload=null,"free"===b._options.ratio&&(b._ratio=e.naturalHeight/e.naturalWidth,b._scaleDropArea(b._ratio));var c=b._options.service&&b._options.push,d=function(){b._save(function(){c||b._stopProgressLoop(),b._removeState("busy"),a.apply(b,[b.data])},c)};c?b._startProgress(d):d()}})}},{key:"_save",value:function(){var a=this,c=arguments.length>0&&arguments[0]!==b?arguments[0]:function(){},d=arguments.length>1&&arguments[1]!==b?arguments[1]:!0;if(!this._isBeingDestroyed){var e=this.dataBase64;this._options.service||this._isInitialising&&!this._isImageOnly()||this._options.willSave.apply(this,[e,function(b){a._store(b),a._options.didSave.apply(a,[b,a])},this]),this._isBeingDestroyed||(this._options.service&&d&&this._options.willSave.apply(this,[e,function(b){a._addState("upload"),a._imageHopper&&a._options.dropReplace&&(a._imageHopper.enabled=!1),a._upload(b,function(d,e){a._imageHopper&&a._options.dropReplace&&(a._imageHopper.enabled=!0),d||a._storeServerResponse(e),a._options.didUpload.apply(a,[d,b,e,a]),a._removeState("upload"),c(d,b,e)})},this]),this._options.service&&d||c())}}},{key:"_storeServerResponse",value:function(a){this._isRequired&&(this._input.required=!1),this._data.server=a,this._output.value="object"===("undefined"==typeof a?"undefined":m(a))?JSON.stringify(this._data.server):a}},{key:"_store",value:function(a){this._isRequired&&(this._input.required=!1),this._output.value=JSON.stringify(a)}},{key:"_upload",value:function(a,b){var c=this;this.requestOutput(function(a,d){var e=c._element.querySelector(".slim-upload-status"),f=c._options.willRequest,g=function(a,b){c._updateProgress(Math.max(.1,a/b))},h=function(a){var d=setTimeout(function(){if(!c._isBeingDestroyed){e.innerHTML=c._options.statusUploadSuccess,e.setAttribute("data-state","success"),e.style.opacity=1;var a=setTimeout(function(){e.style.opacity=0},2e3);c._timers.push(a)}},250);c._timers.push(d),b(null,a)},i=function(a){var d="";d="file-too-big"===a?c._options.statusContentLength:c._options.didReceiveServerError.apply(c,[a,c._options.statusUnknownResponse,c]);var f=setTimeout(function(){e.innerHTML=d,e.setAttribute("data-state","error"),e.style.opacity=1},250);c._timers.push(f),b(a)};"string"==typeof c._options.service?H(c._options.service,c._options.uploadMethod,d,f,g,h,i):"function"==typeof c._options.service&&c._options.service.apply(c,["file"===c._options.serviceFormat?a:d,g,h,i,c])},a)}},{key:"requestOutput",value:function(a,b){var c=this;return this._data.input.file?(b||(b=this.dataBase64),void d.parseMetaData(this._data.input.file,function(e){var f=[],g=new FormData;if(G("input",c._options.post)&&(f.push(c._data.input.file),g.append(c._inputReference,c._data.input.file,c._data.input.file.name)),G("output",c._options.post)&&null!==c._data.output.image&&c._options.uploadBase64===!1){var h=Z(b.output.image,b.output.name);if(e.imageHead&&c._options.copyImageHead)try{h=new Blob([e.imageHead,d.blobSlice.call(h,20)],{type:ub(b.output.image)}),h=U(h,b.output.name)}catch(i){}f.push(h);var j="slim_output_"+c._uid;b.output.image=null,b.output.field=j,g.append(j,h,b.output.name)}g.append(c._output.name,JSON.stringify(b)),a(f,g)},{maxMetaDataSize:262144,disableImageHead:!1})):void a(null,null)}},{key:"_showEditor",value:function(){Pb.className=this._options.popoverClassName,Pb.show(),this._imageEditor.show()}},{key:"_hideEditor",value:function(){this._imageEditor.hide();var a=setTimeout(function(){Pb.hide()},250);this._timers.push(a)}},{key:"_showPreview",value:function(a,b){j(a,{fromPosition:[0,50,0],position:[0,0,0],fromScale:[1.5,1.5],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.7,complete:function(){I(a),b&&b()}})}},{key:"_hideResult",value:function(a){var b=this._getIntro();b&&j(b,{fromScale:[1,1],scale:[.5,.5],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,complete:function(){I(b),a&&a()}})}},{key:"_showButtons",value:function(a){if(this._btnGroup){this._btnGroup.style.display="";var b={fromScale:[.5,.5],scale:[1,1],fromPosition:[0,10,0],position:[0,0,0],fromOpacity:0,opacity:1,complete:function(){I(this)},allDone:function(){a&&a()}};this.isDetached()?b.duration=1:(b.delay=function(a){return 250+50*a},b.easing="spring",b.springConstant=.3,b.springDeceleration=.85),j(this._btnGroup.childNodes,b)}}},{key:"_hideButtons",value:function(a){var b=this;if(this._btnGroup){var c={fromScale:[1,1],scale:[.85,.85],fromOpacity:1,opacity:0,allDone:function(){b._btnGroup.style.display="none",a&&a()}};this.isDetached()?c.duration=1:(c.easing="spring",c.springConstant=.3,c.springDeceleration=.75),j(this._btnGroup.childNodes,c)}}},{key:"_hideStatus",value:function(){var a=this._element.querySelector(".slim-upload-status");a.style.opacity=0}},{key:"_doEdit",value:function(){var a=this;a._options.didEdit.apply(a,[a.data,a]),this._data.input.image&&(this._addState("editor"),this._imageEditor||this._appendEditor(),this._imageEditor.showRotateButton=this._options.rotateButton,Pb.inner=this._imageEditor.element,this._imageEditor.open(hb(this._data.input.image),"free"===this._options.ratio?null:this._ratio,this._data.actions.crop,this._data.actions.rotation,function(){a._showEditor(),a._hideButtons(),a._hideStatus()}))}},{key:"_doRemove",value:function(a){var b=this;if(!this._isImageOnly()){this._clearState(),this._addState("empty"),this._hasInitialImage=!1,this._imageHopper&&(this._imageHopper.enabled=!0),this._isRequired&&(this._input.required=!0);var c=this._getOutro();c&&(c.style.opacity="0");var d=this.data;this._resetData();var e=setTimeout(function(){b._isBeingDestroyed||(b._hideButtons(function(){b._toggleButton("upload",!0)}),b._hideStatus(),b._hideResult(),b._options.didRemove.apply(b,[d,b]),a&&a())},this.isDetached()?0:250);return this._timers.push(e),d}}},{key:"_doUpload",value:function(a){var b=this;this._data.input.image&&(this._addState("upload"),this._startProgress(),this._hideButtons(function(){b._toggleButton("upload",!1),b._save(function(c,d,e){b._removeState("upload"),b._stopProgress(),a&&a.apply(b,[c,d,e]),c&&b._toggleButton("upload",!0),b._showButtons()})}))}},{key:"_doDownload",value:function(){var a=this._data.output.image;a&&wb(this._data,this._options.jpegCompression,this._options.forceType)}},{key:"_doDestroy",value:function(){function a(a,b){return 0!==b.filter(function(b){return a.name===b.name&&a.value===b.value}).length}var b=this;this._isBeingDestroyed=!0,this._timers.forEach(function(a){clearTimeout(a)}),this._timers=[],j(this._element,"detach"),this._imageHopper&&(Mb.forEach(function(a){b._imageHopper.element.removeEventListener(a,b)}),this._imageHopper.destroy(),this._imageHopper=null),this._imageEditor&&(Nb.forEach(function(a){b._imageEditor.element.removeEventListener(a,b)}),this._imageEditor.destroy(),this._imageEditor=null),yb(this._btnGroup.children).forEach(function(a){a.removeEventListener("click",b)}),this._input.removeEventListener("change",this),this._element!==this._originalElement&&this._element.parentNode&&this._element.parentNode.replaceChild(this._originalElement,this._element),this._originalElement.innerHTML=this._originalElementInner;var c=p(this._originalElement);c.forEach(function(c){a(c,b._originalElementAttributes)||b._originalElement.removeAttribute(c.name)}),this._originalElementAttributes.forEach(function(d){a(d,c)||b._originalElement.setAttribute(d.name,d.value)}),Qb=Math.max(0,Qb-1),Pb&&0===Qb&&(Pb.destroy(),Pb=null),this._originalElement=null,this._element=null,this._input=null,this._output=null,this._btnGroup=null,this._options=null}},{key:"dataBase64",get:function(){return vb(this._data,this._options.post,this._options.jpegCompression,this._options.forceType,null!==this._options.service)}},{key:"data",get:function(){return sb(this._data)}},{key:"element",get:function(){return this._element}},{key:"service",set:function(a){this._options.service=a}},{key:"size",set:function(a){this.setSize(a,null)}},{key:"rotation",set:function(a){this.setRotation(a,null)}},{key:"forceSize",set:function(a){this.setForceSize(a,null)}},{key:"ratio",set:function(a){this.setRatio(a,null)}}],[{key:"options",value:function(){var a={edit:!0,instantEdit:!1,uploadBase64:!1,meta:{},ratio:"free",devicePixelRatio:1,size:null,rotation:null,crop:null,post:["output","actions"],service:null,serviceFormat:null,filterSharpen:0,push:!1,defaultInputName:"slim[]",minSize:{width:0,height:0},maxFileSize:null,jpegCompression:null,uploadMethod:"POST",download:!1,saveInitialImage:!1,forceType:!1,forceSize:null,forceMinSize:!0,dropReplace:!0,fetcher:null,internalCanvasSize:{width:4096,height:4096},copyImageHead:!1,rotateButton:!0,popoverClassName:null,label:"<p>Drop your image here</p>",labelLoading:"<p>Loading image...</p>",statusFileType:"<p>Invalid file type, expects: $0.</p>",statusFileSize:"<p>File is too big, maximum file size: $0 MB.</p>",statusNoSupport:"<p>Your browser does not support image cropping.</p>",statusImageTooSmall:"<p>Image is too small, minimum size is: $0 pixels.</p>",statusContentLength:'<span class="slim-upload-status-icon"></span> The file is probably too big',statusUnknownResponse:'<span class="slim-upload-status-icon"></span> An unknown error occurred',statusUploadSuccess:'<span class="slim-upload-status-icon"></span> Saved',statusLocalUrlProblem:null,didInit:function(){},didLoad:function(){return!0},didSave:function(){},didUpload:function(){},didReceiveServerError:function(a,b){return b},didRemove:function(){},didEdit:function(){},didTransform:function(){},didConfirm:function(){},didCancel:function(){},didThrowError:function(){},willTransform:function(a,b){b(a)},willSave:function(a,b){b(a)},willRemove:function(a,b){b()},willRequest:function(){},willFetch:function(){},willLoad:function(){}};return Ob.concat(Fb.Buttons).concat("rotate").forEach(function(b){var c=D(b);a["button"+c+"ClassName"]=null,a["button"+c+"Label"]=c,a["button"+c+"Title"]=c}),a}}]),c}();return function(){function a(a){return a?"<p>"+a+"</p>":null}function b(a){var b=window,c=a.split(".");return c.forEach(function(a,d){b[c[d]]&&(b=b[c[d]])}),b!==window?b:null}var c=[],d=function(a){for(var b=0,d=c.length;d>b;b++)if(c[b].isAttachedTo(a))return b;return-1},e=function(a){return a},f=function(a){return"true"===a},g=function(a){return a?"true"===a:!0},h=function(b){return a(b)},i=function(a){return a?b(a):null},j=function(a){if(!a)return null;var b=Ib(a,",");return{width:b[0],height:b[1]}},k=function(a){return a?parseFloat(a):null},l=function(a){return a?parseInt(a,10):null},m=function(a){if(!a)return null;
var b={};return a.split(",").map(function(a){return parseInt(a,10)}).forEach(function(a,c){b[Lb[c]]=a}),b},o={download:f,edit:g,instantEdit:f,minSize:j,size:j,forceSize:j,forceMinSize:g,internalCanvasSize:j,service:function(a){if("undefined"==typeof a)return null;var c=b(a);return c?c:a},serviceFormat:function(a){return"undefined"==typeof a?null:a},fetcher:function(a){return"undefined"==typeof a?null:a},push:f,rotation:function(a){return"undefined"==typeof a?null:parseInt(a,10)},crop:m,post:function(a){return a?a.split(",").map(function(a){return a.trim()}):null},defaultInputName:e,ratio:function(a){return a?a:null},maxFileSize:k,filterSharpen:l,jpegCompression:l,uploadBase64:f,forceType:e,dropReplace:g,saveInitialImage:f,copyImageHead:f,rotateButton:g,label:h,labelLoading:h,popoverClassName:e,devicePixelRatio:e,uploadMethod:e};["FileSize","FileType","NoSupport","ImageTooSmall"].forEach(function(a){o["status"+a]=h}),["ContentLength","UnknownResponse","UploadSuccess","localUrlProblem"].forEach(function(a){o["status"+a]=e}),["Init","Load","Save","Upload","Remove","Transform","ReceiveServerError","Confirm","Cancel","ThrowError"].forEach(function(a){o["did"+a]=i}),["Transform","Save","Remove","Request","Load","Fetch"].forEach(function(a){o["will"+a]=i});var p=["ClassName","Label","Title"];Ob.concat(Fb.Buttons).concat("rotate").forEach(function(a){var b=D(a);p.forEach(function(a){o["button"+b+a]=e})}),Ub.supported=function(){return!("[object OperaMini]"===Object.prototype.toString.call(window.operamini)||"undefined"==typeof window.addEventListener||"undefined"==typeof window.FileReader||!("slice"in Blob.prototype)||"undefined"==typeof window.URL||"undefined"==typeof window.URL.createObjectURL)}(),Ub.parse=function(a){var b,c,d,e=[];for(b=a.querySelectorAll(".slim:not([data-state])"),d=b.length;d--;)c=b[d],e.push(Ub.create(c,Ub.getOptionsFromAttributes(c)));return e},Ub.getOptionsFromAttributes=function(a){var b=n(a),c={meta:{}};for(var d in b){var e=o[d],f=b[d];e?(f=e(f),f=null===f?qb(Ub.options()[d]):f,c[d]=f):0===d.indexOf("meta")&&(c.meta[C(d.substr(4))]=f)}return c},Ub.find=function(a){var b=c.filter(function(b){return b.isAttachedTo(a)});return b?b[0]:null},Ub.create=function(a,b){if(!Ub.find(a)){b||(b=Ub.getOptionsFromAttributes(a));var d=new Ub(a,b);return c.push(d),d}},Ub.destroy=function(a){var b=d(a);return 0>b?!1:(c[b].destroy(),c.splice(b,1),!0)}}(),Ub}();a.fn.slim=function(){var a=c(arguments);if(d(a))return this.each(function(){h.create(this,a[0])});var b=a.shift();switch(b){case"supported":return h.supported;case"destroy":return this.each(function(){h.destroy(this)});case"parse":return this.each(function(){h.parse(this)});default:var i=[];return this.each(function(){var c=h.find(this);c&&(g(c,b)?i.push(c[b].apply(c,a)):e(c,b)?i.push(c[b]):f(c,b)&&i.push(c[b]=a[0]))}),i}}}}(window.jQuery);