$(function(){function a(){j=$("#edit_content").attr("data-id"),k=$("#edit_content").attr("data-save"),l=["undo","redo","|","bold","italic","paragraphFormat","fontSize","color","|","insertHR","align","|","subscript","superscript","fontFamily","fontSize","|","paragraphStyle","|","emoticons","nowrapspace","wrapspace","-","formatOL","formatUL","outdent","indent","insertLink","insertImage","insertVideo","insertFile","insertTable","clearFormatting","|","html","|","savearticle","|","fullscreen","|"],m=["undo","redo","|","paragraphFormat","|","bold","italic","fontSize","color","|","insertHR","quote","align","|","subscript","superscript","fontFamily","fontSize","|","paragraphStyle","|","emoticons","nowrapspace","clearFormatting","|","html","|"],n=$("#edit_summary").attr("data-crop"),o=$("#edit_summary").attr("data-size"),p=$("#edit_summary").attr("data-folder"),q=$("#edit_summary").attr("data-algorythm"),r=$("#edit_summary").attr("data-upload"),s=$("#edit_summary").attr("data-delete"),t=$("#edit_summary").attr("data-gallery")}function b(){u.each(function(){var a=$(this).data("froala.editor");a.opts.imageUploadURL=r+y,a.opts.imageManagerLoadURL=t+z}),v.each(function(){var a=$(this).data("froala.editor");a.opts.imageUploadURL=r+y,a.opts.imageManagerLoadURL=t+z})}function c(){$(".slim-add").each("independant_crop"==C?function(){var a=$(this).data("nth");$("#my-slim-add"+a).slim("ratio",M),$("#my-slim-add"+a).slim("setRatio",M,function(){})}:function(){var a=$(this).data("nth"),b=$("#my-slim").data("cover-width"),c=$("#my-slim").data("cover-height");$("#my-slim-add"+a).slim("ratio",b+":"+c),$("#my-slim-add"+a).slim("setRatio",b+":"+c,function(){})})}function d(a){"independant_crop"==C?$("#my-slim-add"+a).slim("ratio",M):$("#my-slim-add"+a).slim("ratio",$("#my-slim").data("cover-width")+":"+$("#my-slim").data("cover-height"))}function e(a){a?($("#image-resize-summary").show(),$("#froala-summary").show()):($("#image-resize-summary").hide(),$("#froala-summary").hide())}function f(a){a?$("#bordercolorfield").show():$("#bordercolorfield").hide()}function f(a){a?$("#content_bordercolorfield").show():$("#content_bordercolorfield").hide()}function g(a){a?($("#image-resize-content").show(),$("#froala-content").show()):($("#image-resize-content").hide(),$("#froala-content").hide())}function h(a,b,c){var d,e=document.createElement("INPUT");"color"==b&&(d=new jscolor(e)),a.append(e);var f=void 0==a.data(b)?"":a.data(b);"color"==b?d.fromString(0==f.length?c:f):a.find("input").val(0==f.length?c:f),a.find("input").addClass("form-control").attr("name",a.data("type")+"data").attr("id",a.data("type")+"data")}function i(a,b){switch(a){case"color":data_default="000000",h(b,a,data_default);break;case"hexa":data_default="#",h(b,a,data_default)}}var j,k,l,m,n,o,p,q,r,s,t;a();var u=$(".edit_froala_summary"),v=$(".edit_froala_content"),w=$(".edit_froala_name"),x="/"+n+"/"+o+"/"+q,y="/"+p+x,z="?index="+p,A=0,B=[],C=$("#form_crops").val(),D=$("#my-slim").data("media");if($(document).click(function(){$(".alert").hide()}),$("#moreimage").hide(),"video"==D)var E=$("#form_enginevideo").val(),F=$("#idvideo").val();$('.nav-tabs a[href="#setup"]').tab("show"),$('.nav-tabs a[href="#cms_summary"]').click(function(){var a=$("#image-resize-summary");a.find("#setup-image-resize").length||$("#image-resize-content").find("#setup-image-resize").detach().appendTo(a)}),$('.nav-tabs a[href="#cms_content"]').click(function(){var a=$("#image-resize-content");a.find("#setup-image-resize").length||$("#image-resize-summary").find("#setup-image-resize").detach().appendTo(a)}),"gallery"==D&&($('.nav-tabs a[href="#thumb"]').click(function(){var a=$("#cropsetup_thumb");a.find("#cropsetup_form").length||$("#cropsetup_media").find("#cropsetup_form").detach().appendTo(a);var a=$("#fullscreen_thumb");a.find("#fullscreen_form").length||$("#fullscreen_media").find("#fullscreen_form").detach().appendTo(a)}),$('.nav-tabs a[href="#media"]').click(function(){var a=$("#cropsetup_media");a.find("#cropsetup_form").length||$("#cropsetup_thumb").find("#cropsetup_form").detach().appendTo(a);var a=$("#fullscreen_media");a.find("#fullscreen_form").length||$("#fullscreen_thumb").find("#fullscreen_form").detach().appendTo(a)})),$('[data-toggle="tooltip"]').tooltip({placement:"auto bottom",html:!0,container:"body"}),$("a.lang-switcher").click(function(a){a.preventDefault(),$(this).hasClass("active")||(lang=$(this).attr("href"),el=$(this).parent().parent(),el.find(".localisation").not(".hidden").addClass("hidden"),el.find(".localisation."+lang).removeClass("hidden"),el.find("a.lang-switcher").removeClass("active"),$(this).addClass("active"))}),$("a.lang-switcher-textarea").click(function(a){a.preventDefault(),activeli=$(this).parent(),activeli.hasClass("active")||(el=activeli.parent().parent(),lang=$(this).attr("href"),el.find(".localisation").not(".hidden").addClass("hidden"),el.find(".localisation."+lang).removeClass("hidden"),lang=$(this).attr("href"),activeli.parent().find("li.active").removeClass("active"),activeli.addClass("active"))}),void 0!=j&&($.FroalaEditor.DefineIcon("savearticle",{NAME:"save"}),$.FroalaEditor.RegisterCommand("savearticle",{title:"Sauvegarde",focus:!0,undo:!0,refreshAfterCallback:!0,callback:function(){this.$oel.froalaEditor("save.save")}})),InlineStyle={"Big c2v":"font-size: 20px; color: red;","Small c2v":"font-size: 14px; color: blue;"},LinkList=[{text:"Laurent Marques efx design",href:"http://efxdesign.fr",target:"_blank",rel:"nofollow"},{displayText:"Froala",href:"https://froala.com",target:"_blank"}],ParagraphStyles={"fr-text-gray":"Gris","fr-text-bordered":"Encadré","fr-text-spaced":"Espacé","fr-text-uppercase":"Capitale"},u.each(function(){var a=$(this).parent().parent().parent();$(this).froalaEditor({toolbarInline:!1,toolbarSticky:!0,requestWithCORS:!1,imageUploadURL:r+y,imageManagerDeleteURL:s,imageManagerLoadURL:t+z,imageParams:{id:a.attr("id")},pastePlain:!0,imageDefaultAlign:"left",imageDefaultWidth:0,imageDefaultAlign:"left",toolbarButtons:l,toolbarButtonsMD:l,toolbarButtonsSM:l,toolbarButtonsXS:l,inlineStyles:InlineStyle,linkList:LinkList,paragraphStyles:ParagraphStyles,dragInline:!1,imageResize:!0,tabSpaces:4,codeMirrorOptions:{tabSize:4},saveParams:{id:void 0!=j?j:null,body:a.attr("id")},saveParam:a.attr("id"),saveURL:void 0!=j?k:null,enter:$.FroalaEditor.ENTER_BR,language:$("#edit_summary").data("lang")}).on("froalaEditor.image.beforeUpload",function(){})}),v.each(function(){var a=$(this).parent().parent().parent();$(this).froalaEditor({toolbarInline:!1,toolbarSticky:!0,requestWithCORS:!1,imageUploadURL:r+y,imageManagerDeleteURL:s,imageManagerLoadURL:t+z,imageParams:{id:a.attr("id")},pastePlain:!0,imageDefaultAlign:"left",imageDefaultWidth:0,imageDefaultAlign:"left",toolbarButtons:l,toolbarButtonsMD:l,toolbarButtonsSM:l,toolbarButtonsXS:l,inlineStyles:InlineStyle,linkList:LinkList,paragraphStyles:ParagraphStyles,dragInline:!1,imageResize:!0,tabSpaces:4,codeMirrorOptions:{tabSize:4},saveParams:{id:void 0!=j?j:null,body:a.attr("id")},saveParam:a.attr("id"),saveURL:void 0!=j?k:null,enter:$.FroalaEditor.ENTER_BR,language:$("#edit_summary").data("lang")}).on("froalaEditor.image.beforeUpload",function(){})}),w.each(function(){$(this).parent().parent().parent();$(this).froalaEditor({toolbarInline:!1,toolbarSticky:!0,requestWithCORS:!1,pastePlain:!0,toolbarButtons:m,toolbarButtonsMD:m,toolbarButtonsSM:m,toolbarButtonsXS:m,inlineStyles:InlineStyle,linkList:LinkList,paragraphStyles:ParagraphStyles,dragInline:!1,tabSpaces:4,codeMirrorOptions:{tabSize:4},enter:$.FroalaEditor.ENTER_BR,language:$("#edit_summary").data("lang")})}),void 0!=j&&(u.on("froalaEditor.save.after",function(){$(".bb-alert.summary").delay(200).fadeIn().delay(1e3).fadeOut()}),u.on("froalaEditor.save.error",function(){$(".bb-alert.error").delay(200).fadeIn().delay(2e3).fadeOut()})),$(".foldermedia").change(function(){$("#edit_summary").attr("data-folder",this.value),a(),z="?index="+this.value,y="/"+this.value+x,b()}),$(".size").change(function(){$("#edit_summary").attr("data-size",this.value),a(),x="/"+n+"/"+this.value+"/"+q,y="/"+p+x,b()}),$(".crop").change(function(){$("#edit_summary").attr("data-crop",this.value),a(),x="/"+this.value+"/"+o+"/"+q,y="/"+p+x,b()}),$(".algorythm").change(function(){$("#edit_summary").attr("data-algorythm",this.value),a(),x="/"+n+"/"+o+"/"+this.value,y="/"+p+x,b()}),$(".selectpicker").selectpicker();{var G,n=$("#my-slim").data("crop").split(","),H=$("#my-slim").data("thumb-width"),I=$("#my-slim").data("thumb-height"),J=$("#form_column").val().replace("app-thumb.bootstrap.",""),K=$("#my-slim").data("thumb-"+J+"-width"),L=$("#my-slim").data("thumb-"+J+"-height"),M=($("#my-slim").data("webhd-width"),$("#my-slim").data("webhd-height"),"free"),N=!0,O=$("#my-slim").data("rotation"),P=$("#my-slim").data("service"),Q=$("#my-slim").data("serviceadd"),R=$("#my-slim").data("meta-post-id"),S=$("#my-slim").data("meta-post-slug");$("#my-slim").slim({didLoad:function(){return!0},didEdit:function(){$("#my-slim").slim("ratio",M)},didConfirm:function(a){var b=a.output.width,c=a.output.height;$("#my-slim").attr("data-cover-width",b),$("#my-slim").attr("data-cover-height",c),$(".addimage").show(),$("#my-slim").attr("data-ratio",b+":"+c)},forceMinSize:!1,ratio:M,state:"preview",willRemove:function(a,b){window.confirm("Est-ce que vous etes sur de supprimer l'image ?")&&(j=$("#my-slim").data("imageid"),$.ajax({method:"POST",url:"/efx/upload/slim_remove_gallery/"+j+"/"+D}).done(function(){$(".addimage").hide(),b()}))},minSize:{width:H,height:I},statusImageTooSmall:"L'image est trop petite, la taille minimun est de : $0 pixels",size:{width:K,height:L},crop:{x:n[0],y:n[1],width:n[2],height:n[3]},filterSharpen:20,rotation:O,service:P,download:!0,push:!0,instantEdit:!0,post:["input","output","actions"],label:"Glissez et déposer une image ici.",buttonConfirmLabel:"Ok",meta:{postId:R,postSlug:S}})}$("#form_column").on("hidden.bs.select",function(){J=$(this).val().replace("app-thumb.bootstrap.",""),width=$("#my-slim").data("thumb-"+J+"-width"),height=$("#my-slim").data("thumb-"+J+"-height"),$("#my-slim").slim("size",{width:width,height:height}),$("#my-slim").slim("setSize",{width:width,height:height},function(){})}),$("#form_crop_presets").on("hidden.bs.select",function(){M=$(this).val(),void 0==$("#orientation:checked").val()&&"free"!=M&&(val=M.split(":"),M=val[1]+":"+val[0],N=!1)}),$("#orientation").on("change",function(){G=void 0==$("#orientation:checked").val()?"vertical":"horyzontale",M=$("#form_crop_presets").val(),1==N&&"vertical"==G&&(M=$("#form_crop_presets").val(),"free"!=M&&(val=M.split(":"),M=val[1]+":"+val[0]),N=!1),0==N&&"horyzontale"==G&&(M=$("#form_crop_presets").val(),N=!0)}),$("#form_crops").on("hidden.bs.select",function(){C=$(this).val()}),$("#run_crop").on("click",function(a){a.preventDefault(),window.confirm("Est-ce que vous etes sur de recader toutes les images de la galerie (effacant les cadrages actuels) ?")&&c()}),$("#summary_switch").change(function(){e($(this).prop("checked"))}),e($("#summary_switch").prop("checked")),$("#postborder").change(function(){f($(this).prop("checked"))}),f($("#postborder").prop("checked")),$("#contentborder").change(function(){f($(this).prop("checked"))}),f($("#contentborder").prop("checked")),$("#content_switch").change(function(){g($(this).prop("checked"))}),g($("#content_switch").prop("checked")),i($("#postbgselect option:selected").val(),$("#postbgdata_wrapper")),i($("#postborderselect option:selected").val(),$("#postborderdata_wrapper")),i($("#contentbgselect option:selected").val(),$("#contentbgdata_wrapper")),i($("#contentborderselect option:selected").val(),$("#contentborderdata_wrapper")),$("#postbgselect, #postborderselect, #contentbgselect, #contentborderselect").on("change",function(){var a=this.value,b=$(this).next().next();b.empty(),i(a,b)}),"gallery"==D&&($(".slim-add").each(function(){A=$(this).data("nth"),imagecrop=$("#my-slim-add"+A).data("crop").split(",");var a=$("#my-slim-add"+A).data("service");B[A]=$("#my-slim-add"+A).slim({willRemove:function(){window.confirm("Est-ce que vous etes sur de supprimer l'image ? ")&&(slimObj=this._element.id,j=$("#"+slimObj).data("imageid"),nth=$("#"+slimObj).data("nth"),$.ajax({method:"POST",url:"/efx/upload/slim_remove_image_by_id/"+j+"/gallery"}).done(function(){$("#my-slim-add"+nth).parent().remove()}))},didEdit:function(){var a=this.data.meta.imageNth;d(a)},didConfirm:function(a){var b=a.output.width,c=a.output.height,d=this.data.meta.imageNth;$("#my-slim-add"+d).attr("data-cover-width",b),$("#my-slim-add"+d).attr("data-cover-height",c),$("#my-slim-add"+d).attr("data-ratio",b+":"+c)},rotation:O,service:a,minSize:{width:H,height:I},statusImageTooSmall:"L'image est trop petite, la taille minimun est de : $0 pixels",crop:{x:imagecrop[0],y:imagecrop[1],width:imagecrop[2],height:imagecrop[3]},download:!0,push:!0,instantEdit:!0,post:["input","output","actions"],label:"Glissez et déposer une image ici.",buttonConfirmLabel:"Ok",didUpload:function(a){null==a&&$(".slim-loader").css("opacity",0)},meta:{postId:R,postSlug:S,imageNth:A}}),$("#moreimage").show()}),$(".addimage").on("click",function(a){if(a.preventDefault(),$("#moreimage").show(),"empty"!=$("#my-slim-add"+A).data("state")){A++;var b=$("<div></div>",{"class":"col-md-3 glyphicon-move-none"}),c=$('<span class="fa fa-arrows" > Image '+A+"</span>"),e=$("<div></div>",{id:"my-slim-add"+A,"class":"slim-add","data-nth":A}),f=A;b.append(c),b.append(e),$("#moreimage .gallery-thumbs").append(b);{$("#my-slim").data("ratio").toString()}B[A]=$("#my-slim-add"+A).slim({willRemove:function(){window.confirm("Est-ce que vous etes sur de supprimer l'image ? ")&&$.ajax({method:"POST",url:"/efx/upload/slim_remove_image_by_nth/"+f+"/"+R+"/gallery"}).done(function(){$("#my-slim-add"+f).parent().remove()})},didEdit:function(){var a=this.data.meta.imageNth;d(a)},didConfirm:function(a){var b=a.output.width,c=a.output.height,d=this.data.meta.imageNth;$("#my-slim-add"+d).attr("data-cover-width",b),$("#my-slim-add"+d).attr("data-cover-height",c),$("#my-slim-add"+d).attr("data-ratio",b+":"+c),$(".image-setup, .gallery-controls").show()},rotation:O,service:Q+"/**NEWIMAGE**/"+f+"/"+R,minSize:{width:H,height:I},statusImageTooSmall:"L'image est trop petite, la taille minimun est de : $0 pixels",download:!0,push:!0,instantEdit:!0,post:["input","output","actions"],label:"Glissez et déposer une image ici.",buttonConfirmLabel:"Ok",didUpload:function(a){null==a&&$(".slim-loader").css("opacity",0)},meta:{postId:R,postSlug:S,imageNth:A}}),d(A)}}),Sortable.create(moreimage,{handle:".glyphicon-move",animation:150,onEnd:function(){var a="",b=0;$(".slim-add").each(function(){a=b>0?a+","+$(this).data("imageid"):$(this).data("imageid"),b++}),console.log(a),$.ajax({method:"POST",url:"/media/backend/api/sortgallery/"+a})}})),"sketchfab"==D&&($("#validatesketchfab").on("click",function(){$("#sketchfabmodal").modal("toggle")}),$("#checksketchfab").on("click",function(a){a.stopPropagation(),$("#sketchfabcode").empty(),id_sketchfab=$("#idsketchfab").val(),code='<iframe id="sketchfab-viewer" class="sketchframe" src="" width="600" height="300" ></iframe>',$("#sketchfabcode").append(code),model=$("#idsketchfab").val(),version="1.0.0",sketch=document.getElementById("sketchfab-viewer"),client=new Sketchfab(version,sketch),client.init(model,{success:function(a){a.start(),$("#sketchfabmodal").modal("show")},error:function(){alert("Sketchfab API Error!")}})})),"video"==D&&($("#idvideo").on("change paste keyup",function(){j=$("#idvideo").val(),$("#checkvideo").data("vimeoidvalidate","false")}),$("#form_enginevideo").change(function(){j=$("#idvideo").val(),$("#checkvideo").data("vimeoidvalidate","false")}),$("#cancelvimeo").on("click",function(){$("#checkvideo").data("vimeoidvalidate","false")}),$("#validatevimeo").on("click",function(){$("#checkvideo").data("vimeoidvalidate","true"),$("#vimeomodal").modal("toggle")}),$("#checkvideo").on("click",function(a){a.stopPropagation(),$.ajaxSetup({statusCode:{404:function(){alert("vimeo"==E?"Prière de corriger l'ID Viméo qui n'est pas correcte.":"Prière de corriger l'ID youtube qui n'est pas correcte.")},200:function(){$("#vimeocode").empty(),code="vimeo"==E?'<iframe src="//player.vimeo.com/video/'+F+'?api=1&player_id=vimeoplayer&title=0&amp;byline=0&amp;portrait=0" name="vimeoplayer" id="nofocusvideo" width="615" height="346" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>':'<iframe width="560" height="315" src="https://www.youtube.com/embed/'+F+'?ecver=1" frameborder="0" allowfullscreen></iframe>',$("#vimeocode").append(code),$("#vimeomodal").modal("show")}}}),E=$("#form_enginevideo").val(),F=$("#idvideo").val(),$.get("vimeo"==E?"/efx/upload/testvimeo/"+F:"/efx/upload/testyoutube/"+F)}))});