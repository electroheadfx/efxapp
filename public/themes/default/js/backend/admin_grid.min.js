$(function(){function a(){var a=(location.hash,location.hash.match(/filter=([^&]+)/i)),b=a&&a[1];return b&&decodeURIComponent(b)}function b(){var b=a();(b||!l)&&(l=!0,g.isotope({layoutMode:"packery",itemSelector:".grid-item",filter:b,animationOptions:{duration:500,easing:"swing"}}),b&&($(".button-category .active").removeClass("active"),"*"==b?$(".button-category .all").addClass("active"):$(".button-category "+b).addClass("active")))}function c(a,b){var c;return function(){function d(){a(),c=null}c&&clearTimeout(c),c=setTimeout(d,b||100)}}if($("#listWithHandle").length){var d=$("#listWithHandle").data("delete-url").replace("http://","").split("/");d.pop();var e=d[0];d="http://"+d.join("/")+"/"}$('[data-toggle="tooltip-project"],[data-toggle="tooltip-media"]').tooltip({placement:"auto top",container:"body",delay:{show:300,hide:200}}),$(".tooltip-post").tooltip({html:!0,delay:{show:50,hide:20}}),$(".tooltip-post-thumb").tooltip({html:!0,delay:{show:0,hide:0},template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner tooltip-inner-post-thumb"></div></div>'}),$(".tooltip-post-thumb").hover(function(){},function(){$(this).tooltip("hide")}),$(".toggle-grid-admin-select").change(function(){if(!$(this).prop("checked")){var a=$(this).data("post-id");$(this).parent().parent().parent().next().find(".delete-post").attr("href",d+a)}var b="",c=[];$(".toggle-grid .toggle:not(.off) .toggle-grid-admin-select").each(function(){b+=$(this).data("post-id")+",",c.push($(this).parent().parent().parent().next().find(".delete-post"))}),b=b.slice(0,-1),c.forEach(function(a){$(a).attr("href",d+b)})}),$(".share").on("click",function(){event.preventDefault();var a="http://"+e+"/p/";if($(".toggle-grid .toggle:not(.off)").length<2)var a=$(this).attr("href");else $(".toggle-grid .toggle:not(.off) .toggle-grid-admin-select").each(function(){a+=$(this).data("post-slug")+","}),a=a.slice(0,-1);$("#sharemodal #inputShareURL").val(a),$("#sharemodal #paste").attr("data-clipboard-text",a),$("#sharemodal #open").attr("href",a),$("#sharemodal #facebook").attr("href",$("#sharemodal #facebook").data("facebook")+a),$("#sharemodal #twitter").attr("href",$("#sharemodal #twitter").data("twitter")+a),$("#sharemodal #google").attr("href",$("#sharemodal #google").data("google")+a),$("#sharemodal #pinterest").attr("href",$("#sharemodal #pinterest").data("pinterest")+a),$("#sharemodal").modal("show")}),pasteboard=new ClipboardJS(".paste-url"),$("#paste, #twitter, #facebook, #open").on("click",function(){$("#sharemodal").modal("hide")}),$("option#uncategorized").attr("disabled","disabled"),$(".chosen-select").chosen({allow_single_deselect:!0}),$(".chosen-select").change(function(a,b){var c=$(this).parent(),d=c.data("post-id"),e=($(this).find(":selected").data("cat-id"),$(this).find(":selected").attr("id"),$("option#uncategorized").val()),f=($(this).find(":selected").val(),$(this).val()),g=c.data("exposition"),i=[d];f?($(this).find("option#uncategorized").prop("selected",!1).trigger("chosen:updated"),b.selected?(i.push(f.length>1?"selected":"selected-remove-uncategorized"),data=b.selected):(i.push("deselected"),data=b.deselected),cat=data.split(","),i.push({category_id:cat[0],category_slug:cat[1],category_name:cat[2],exposition:g})):($(this).val(e).trigger("chosen:updated"),i.push("deselected-add-uncategorized"),data=b.deselected,cat=data.split(","),i.push({category_id:cat[0],category_slug:cat[1],category_name:cat[2],exposition:g})),$.ajax({method:"POST",url:"/media/backend/media/change_category",data:"datapost="+JSON.stringify(i),dataType:"text",success:function(a){a=JSON.parse(a),d=a.post_id,action=a.action,category_slug=a.category_slug,category_name=a.category_name,"deselected"==action?$("#"+d).removeClass(category_slug):$("#"+d).addClass("selected"==action?category_slug:"uncategorized"),k.isotope({filter:h})},error:function(){alert("error with chosen-select")}})}),$(".chosen-choices").attr("style","height: 34px!important;"),$(".chosen-container").hover(function(){el=$(this).find(".chosen-choices"),el.attr("style",""),el.parent().attr("style","position:absolute; width: 238px;")},function(){el.attr("style",""),el.attr("style","height: 34px!important;"),el.parent().attr("style","width: 238px;"),el.parent().parent().parent().find(".tooltip-post").tooltip("hide")});var f,g=$("#listWithHandle"),h="*",i={layoutMode:"packery",itemSelector:".grid-item-backend",filter:h,animationOptions:{duration:500,easing:"swing"}},j={layoutMode:"packery",itemSelector:".grid-item",filter:function(){return f?$(this).find("#tags").text().match(f):!0},animationOptions:{duration:500,easing:"swing"}},k=g.isotope(i),l=!1;if($(window).on("hashchange",b),b(),$(".remove").click(function(){$(".isotope-search").val(""),$(this).find("i.fa-remove").attr("class","fa fa-search"),f=new RegExp(m.val(),"gi"),$("#listWithHandle").length&&sort.option("disabled",!1),$(".glyphicon-move").css("cursor",""),$(".glyphicon-move .fa-arrows").css("opacity",1),k.isotope(j),Cookies.set("position_search",m.val())}),$("a.attr-status, a.attr-permission, a.attr-featured, a.attr-locked").click(function(a){a.preventDefault(),trigger=$(this),$.ajax({method:"POST",url:trigger.attr("href"),success:function(a){trigger.empty().append(a.html),trigger.attr("href",a.url),attr="."+trigger.attr("class")+"-meta",attribute_toggle=trigger.attr("data-attr-toggle"),attribute_data=trigger.attr("data-attr"),meta_el=trigger.parent().parent().parent().find(attr),data_text=meta_el.attr("data-text-"+attribute_data),meta_el.text(data_text),trigger.attr("data-attr-toggle",attribute_data),trigger.attr("data-attr",attribute_toggle),""!=$(".isotope-search").val()&&$(".isotope-search").trigger("keyup"),$(".tooltip-post").tooltip()}})}),$("#listWithHandle").length){sort=Sortable.create(listWithHandle,{handle:".glyphicon-move",animation:150,filter:".ignore-elements",onStart:function(a){a.oldIndex,g.isotope("destroy"),"*"!=h&&($("#listWithHandle .element").addClass("ignore-elements"),$("#listWithHandle .element"+h).removeClass("ignore-elements"))},onEnd:function(){var a="",b=0;$(".element").each(function(){a=b>0?a+","+$(this).attr("id"):$(this).attr("id"),b++}),$.ajax({method:"POST",url:"/media/backend/api/sortpost/"+a}),$("#listWithHandle .element").removeClass("ignore-elements"),k.isotope({filter:h})}});var m=$(".isotope-search").keyup(c(function(){sort.option("disabled",!0),$(".glyphicon-move").css("cursor","default"),$(".glyphicon-move .fa-arrows").css("opacity",0),$(".isotope-search").parent().find("i.fa-search").attr("class","fa fa-remove"),f=new RegExp(m.val(),"gi"),k.isotope(j),Cookies.set("position_search",m.val())},200))}Cookies.get("jquery_position_category")&&$(".filters .button-category a"+Cookies.get("jquery_position_category")).trigger("click"),Cookies.get("position_search")&&$(".isotope-search").val(Cookies.get("position_search")).trigger("keyup"),$filters=$(".filters .button-category a").on("click",function(a){a.preventDefault(),$(".collapse.navbar-collapse.navbar-right").removeClass("in"),$(".filters a.active").removeClass("active"),$(this).addClass("active"),$(".isotope-search").val(""),$("#listWithHandle").length&&sort.option("disabled",!1),$(".glyphicon-move").css("cursor",""),$(".glyphicon-move .fa-arrows").css("opacity",1),h=$(this).data("filter");var b;return b=$(this).hasClass("all")?$(this).parent().next().find("a").data("id"):$(this).data("id"),$(".create").each(function(){var a=$(this).attr("href").split("?"),c=a[0];$(this).attr("href",c+"?cat="+b)}),Cookies.set("jquery_position_category",$(this).data("filter")),location.hash="filter="+encodeURIComponent(h),k.isotope({filter:h}),!1});var n=$(".button-category a.all").parent().next().find("a").data("id");$(".create").each(function(){var a=$(this).attr("href").split("?"),b=a[0];$(this).attr("href",b+"?cat="+n)}),$(document).click(function(){$(".alert").hide()})});